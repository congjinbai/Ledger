<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå•†åˆä½œè´¦ç°¿ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary-color: #0078d7;
            --secondary-color: #f3f2f1;
            --border-color: #d2d0ce;
            --text-color: #323130;
            --hover-color: #deecf9;
            --header-height: 44px;
            --footer-height: 50px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 932px;
            background-color: white;
        }
        
        /* å¤´éƒ¨å¯¼èˆª */
        .header {
            height: var(--header-height);
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        /* åº•éƒ¨å¯¼èˆª */
        .footer {
            height: var(--footer-height);
            background-color: var(--secondary-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid var(--border-color);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px; /* å‡å°å­—ä½“å¤§å° */
            color: var(--text-color);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
        
        .nav-item.active {
            color: var(--primary-color);
            background-color: var(--hover-color);
        }
        
        .nav-item i {
            font-size: 18px;
            margin-bottom: 2px;
        }
        
        /* Windowså¯¹è¯æ¡†é£æ ¼å¡ç‰‡ */
        .card {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card-header {
            background-color: var(--secondary-color);
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }
        
        .card-body {
            padding: 12px;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .form-col {
            flex: 1;
            margin-right: 10px;
        }
        
        .form-col:last-child {
            margin-right: 0;
        }
        
        label {
            display: block;
            margin-bottom: 4px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        input, select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            font-size: 14px;
            background-color: white;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .display-box {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            background-color: var(--secondary-color);
            font-size: 14px;
            text-align: left;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background-color: #106ebe;
        }
        
        .btn-danger {
            background-color: #d13438;
        }
        
        .btn-danger:hover {
            background-color: #b02a30;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid var(--border-color);
            padding: 6px 8px;
            text-align: left;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
        
        th {
            background-color: var(--secondary-color);
            font-weight: 600;
            position: relative;
        }
        
        .filter-icon {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        
        /* é¡µé¢éšè—/æ˜¾ç¤º */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* è®¾ç½®é¡µæ ·å¼ */
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-section h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--primary-color);
        }
        
        textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }
        
        /* ä¸‹æ‹‰åˆ—è¡¨æ ·å¼ */
        .dropdown {
            position: relative;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 100%;
            border: 1px solid var(--border-color);
            border-top: none;
            z-index: 1;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .dropdown-content div {
            padding: 8px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .dropdown-content div:hover {
            background-color: var(--hover-color);
        }
        
        .dropdown.active .dropdown-content {
            display: block;
        }
        
        /* å¸ç§é€‰æ‹©æ ·å¼ */
        .currency-select {
            width: auto;
            min-width: 80px;
        }
        
        /* éšè—å…ƒç´  */
        .hidden {
            display: none;
        }
        
        /* è¡¨æ ¼æ“ä½œæŒ‰é’® */
        .table-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        /* å‹¾é€‰æ¡†æ ·å¼ */
        .checkbox-cell {
            width: 30px;
            text-align: center;
        }
        
        /* è¡¨æ ¼åº•éƒ¨æ€»è®¡è¡Œ */
        .table-total {
            background-color: var(--secondary-color);
            font-weight: bold;
        }
        
        /* è¡¨æ ¼åº•éƒ¨ç­›é€‰ç»“æœè¡Œ */
        .table-filter-result {
            background-color: #f0f8ff;
            font-style: italic;
        }
        
        /* å¯ç¼–è¾‘å•å…ƒæ ¼ */
        .editable-cell {
            cursor: pointer;
        }
        
        .editable-cell:hover {
            background-color: var(--hover-color);
        }
        
        /* ç»“ç®—çŠ¶æ€é€‰æ‹©å™¨ */
        .settlement-select {
            width: 80px;
            padding: 4px;
            font-size: 12px;
        }
        
        /* æè¿°å’Œå¤‡æ³¨åˆ—å…è®¸æ¢è¡Œ */
        .description-cell, .notes-cell {
            white-space: normal !important;
            word-wrap: break-word;
            max-width: 150px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ç”µå•†åˆä½œè´¦ç°¿ç³»ç»Ÿ</h1>
        </div>
        
        <div class="content">
            <!-- æ¦‚è§ˆé¡µé¢ -->
            <div id="overview-page" class="page active">
                <div class="card">
                    <div class="card-header">è´¦æˆ·æ¦‚è§ˆ</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label>OZONè´¦æˆ·ä½™é¢(â‚½)</label>
                                <div id="ozon-balance" class="display-box">0</div>
                            </div>
                            <div class="form-col">
                                <label>WBè´¦æˆ·ä½™é¢(â‚½)</label>
                                <div id="wb-balance" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>ä¸ªä½“è´¦æˆ·ä½™é¢(â‚½)</label>
                                <div id="individual-balance" class="display-box">0</div>
                            </div>
                            <div class="form-col">
                                <label>ç°é‡‘ä½™é¢(â‚½)</label>
                                <div id="cash-balance" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ€»é‡‘é¢(â‚½)</label>
                                <div id="total-balance" class="display-box">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è´¦æˆ·ä½™é¢é¡µé¢ -->
            <div id="balance-page" class="page">
                <div class="card">
                    <div class="card-header">è´¦æˆ·ä½™é¢è®¾ç½®</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label>OZONè´¦æˆ·ä½™é¢(â‚½)</label>
                                <input type="text" id="ozon-input" placeholder="è¾“å…¥é‡‘é¢">
                            </div>
                            <div class="form-col">
                                <label>WBè´¦æˆ·ä½™é¢(â‚½)</label>
                                <input type="text" id="wb-input" placeholder="è¾“å…¥é‡‘é¢">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>ä¸ªä½“è´¦æˆ·ä½™é¢(â‚½)</label>
                                <input type="text" id="individual-input" placeholder="è¾“å…¥é‡‘é¢">
                            </div>
                            <div class="form-col">
                                <label>ç°é‡‘ä½™é¢(â‚½)</label>
                                <div id="cash-display" class="display-box">0</div>
                            </div>
                        </div>
                        <button class="btn" id="save-balance">ä¿å­˜ä½™é¢</button>
                    </div>
                </div>
            </div>
            
            <!-- å•†å“æ¸…å•é¡µé¢ -->
            <div id="products-page" class="page">
                <div class="card">
                    <div class="card-header">å•†å“æ¸…å•</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label>åˆ°è´§æ—¥æœŸ</label>
                                <input type="text" id="arrival-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>å•†å“åç§°</label>
                                <div class="dropdown">
                                    <input type="text" id="product-name" placeholder="è¾“å…¥å•†å“åç§°">
                                    <div class="dropdown-content" id="product-name-dropdown"></div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label>é¢œè‰²</label>
                                <select id="color-select">
                                    <option value="">é€‰æ‹©é¢œè‰²</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ•°é‡</label>
                                <input type="text" id="quantity" placeholder="è¾“å…¥æ•°é‡">
                            </div>
                            <div class="form-col">
                                <label>å•ä½</label>
                                <select id="unit-select">
                                    <option value="">é€‰æ‹©å•ä½</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>å•ä»·(Â¥)</label>
                                <input type="text" id="unit-price" placeholder="è¾“å…¥å•ä»·">
                            </div>
                            <div class="form-col">
                                <label>æ±‡ç‡</label>
                                <input type="text" id="exchange-rate" placeholder="è¾“å…¥æ±‡ç‡">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æŠ˜åˆå¢å¸ƒ</label>
                                <div id="ruble-price" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>é‡‘é¢(Â¥)</label>
                                <div id="cny-amount" class="display-box">0</div>
                            </div>
                            <div class="form-col">
                                <label>é‡‘é¢(â‚½)</label>
                                <div id="ruble-amount" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æè¿°</label>
                                <input type="text" id="product-description" placeholder="è¾“å…¥æè¿°">
                            </div>
                        </div>
                        <button class="btn" id="add-product">æ·»åŠ å•†å“</button>
                        
                        <div class="table-actions">
                            <div>
                                <button class="btn" id="select-all-products">å…¨é€‰</button>
                                <button class="btn" id="deselect-all-products">å–æ¶ˆå…¨é€‰</button>
                            </div>
                            <div>
                                <button class="btn" id="clear-filter-products">å–æ¶ˆç­›é€‰</button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table id="products-table">
                                <thead>
                                    <tr>
                                        <th class="checkbox-cell"><input type="checkbox" id="products-check-all"></th>
                                        <th>æ—¥æœŸ <span class="filter-icon">ğŸ”</span></th>
                                        <th>å•†å“åç§° <span class="filter-icon">ğŸ”</span></th>
                                        <th>é¢œè‰² <span class="filter-icon">ğŸ”</span></th>
                                        <th>æ•°é‡ <span class="filter-icon">ğŸ”</span></th>
                                        <th>å•ä½ <span class="filter-icon">ğŸ”</span></th>
                                        <th>å•ä»·(Â¥) <span class="filter-icon">ğŸ”</span></th>
                                        <th>é‡‘é¢(Â¥) <span class="filter-icon">ğŸ”</span></th>
                                        <th>æ±‡ç‡ <span class="filter-icon">ğŸ”</span></th>
                                        <th>å•ä»·(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>é‡‘é¢(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>æè¿° <span class="filter-icon">ğŸ”</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- å•†å“è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tbody>
                                <tfoot>
                                    <!-- æ€»è®¡è¡Œå’Œç­›é€‰ç»“æœè¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¿è´¹æ”¯å‡ºé¡µé¢ -->
            <div id="shipping-page" class="page">
                <div class="card">
                    <div class="card-header">è¿è´¹æ”¯å‡º</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ—¥æœŸ</label>
                                <input type="text" id="shipping-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                            <div class="form-col">
                                <label>è´§å·</label>
                                <input type="text" id="shipping-code" placeholder="è¾“å…¥è´§å·">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>å•†å“åç§°</label>
                                <input type="text" id="shipping-product" placeholder="è¾“å…¥å•†å“åç§°">
                            </div>
                            <div class="form-col">
                                <label>é‡é‡(Kg)</label>
                                <input type="text" id="shipping-weight" placeholder="è¾“å…¥é‡é‡">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>ä½“ç§¯mÂ³</label>
                                <input type="text" id="shipping-volume" placeholder="è¾“å…¥ä½“ç§¯">
                            </div>
                            <div class="form-col">
                                <label>ä»¶æ•°</label>
                                <input type="text" id="shipping-quantity" placeholder="è¾“å…¥ä»¶æ•°">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>è¿è´¹</label>
                                <input type="text" id="shipping-fee" placeholder="è¾“å…¥è¿è´¹">
                            </div>
                            <div class="form-col">
                                <label>å¸ç§</label>
                                <select id="shipping-currency" class="currency-select">
                                    <option value="">é€‰æ‹©å¸ç§</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ±‡ç‡</label>
                                <input type="text" id="shipping-exchange-rate" placeholder="è¾“å…¥æ±‡ç‡">
                            </div>
                            <div class="form-col">
                                <label>æŠ˜åˆå¢å¸ƒ</label>
                                <div id="shipping-ruble" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ‰˜ç›˜è´¹(â‚½)</label>
                                <input type="text" id="pallet-fee" placeholder="è¾“å…¥æ‰˜ç›˜è´¹">
                            </div>
                            <div class="form-col">
                                <label>ç«‹æ–¹è´¹(â‚½)</label>
                                <input type="text" id="cube-fee" placeholder="è¾“å…¥ç«‹æ–¹è´¹">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>é€è´§è½¦è´¹(â‚½)</label>
                                <input type="text" id="delivery-fee" placeholder="è¾“å…¥é€è´§è½¦è´¹">
                            </div>
                            <div class="form-col">
                                <label>è¿è´¹æ€»è®¡(â‚½)</label>
                                <div id="shipping-total" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>å¤‡æ³¨</label>
                                <input type="text" id="shipping-notes" placeholder="è¾“å…¥å¤‡æ³¨">
                            </div>
                        </div>
                        <button class="btn" id="add-shipping">æ·»åŠ è¿è´¹</button>
                        
                        <div class="table-actions">
                            <div>
                                <button class="btn" id="select-all-shipping">å…¨é€‰</button>
                                <button class="btn" id="deselect-all-shipping">å–æ¶ˆå…¨é€‰</button>
                            </div>
                            <div>
                                <button class="btn" id="clear-filter-shipping">å–æ¶ˆç­›é€‰</button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table id="shipping-table">
                                <thead>
                                    <tr>
                                        <th class="checkbox-cell"><input type="checkbox" id="shipping-check-all"></th>
                                        <th>æ—¥æœŸ <span class="filter-icon">ğŸ”</span></th>
                                        <th>å•†å“åç§° <span class="filter-icon">ğŸ”</span></th>
                                        <th>è´§å· <span class="filter-icon">ğŸ”</span></th>
                                        <th>ä»¶æ•° <span class="filter-icon">ğŸ”</span></th>
                                        <th>é‡é‡ <span class="filter-icon">ğŸ”</span></th>
                                        <th>ä½“ç§¯ <span class="filter-icon">ğŸ”</span></th>
                                        <th>è¿è´¹ <span class="filter-icon">ğŸ”</span></th>
                                        <th>å¸ç§ <span class="filter-icon">ğŸ”</span></th>
                                        <th>æŠ˜åˆå¢å¸ƒ(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>æ‰˜ç›˜è´¹(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>ç«‹æ–¹è´¹(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>é€è´§è½¦è´¹(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>è¿è´¹æ€»è®¡(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>ç»“ç®— <span class="filter-icon">ğŸ”</span></th>
                                        <th>å¤‡æ³¨ <span class="filter-icon">ğŸ”</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- è¿è´¹è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tbody>
                                <tfoot>
                                    <!-- æ€»è®¡è¡Œå’Œç­›é€‰ç»“æœè¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ”¶æ”¯è®°å½•é¡µé¢ -->
            <div id="records-page" class="page">
                <div class="card">
                    <div class="card-header">æ”¶æ”¯è®°å½•</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ—¥æœŸ</label>
                                <input type="text" id="record-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ”¶æ”¯ç±»å‹</label>
                                <select id="record-type">
                                    <option value="">é€‰æ‹©æ”¶æ”¯ç±»å‹</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label>æ”¶æ”¯å½¢å¼</label>
                                <select id="record-form">
                                    <option value="">é€‰æ‹©æ”¶æ”¯å½¢å¼</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>é‡‘é¢(â‚½)</label>
                                <input type="text" id="record-amount" placeholder="è¾“å…¥é‡‘é¢">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æè¿°</label>
                                <input type="text" id="record-description" placeholder="è¾“å…¥æè¿°">
                            </div>
                        </div>
                        <button class="btn" id="add-record">æ·»åŠ è®°å½•</button>
                        
                        <div class="table-actions">
                            <div>
                                <button class="btn" id="select-all-records">å…¨é€‰</button>
                                <button class="btn" id="deselect-all-records">å–æ¶ˆå…¨é€‰</button>
                            </div>
                            <div>
                                <button class="btn" id="clear-filter-records">å–æ¶ˆç­›é€‰</button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table id="records-table">
                                <thead>
                                    <tr>
                                        <th class="checkbox-cell"><input type="checkbox" id="records-check-all"></th>
                                        <th>æ—¥æœŸ <span class="filter-icon">ğŸ”</span></th>
                                        <th>æ”¶æ”¯ç±»å‹ <span class="filter-icon">ğŸ”</span></th>
                                        <th>æ”¶æ”¯å½¢å¼ <span class="filter-icon">ğŸ”</span></th>
                                        <th>é‡‘é¢(â‚½) <span class="filter-icon">ğŸ”</span></th>
                                        <th>ç»“ç®— <span class="filter-icon">ğŸ”</span></th>
                                        <th>æè¿° <span class="filter-icon">ğŸ”</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- æ”¶æ”¯è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tbody>
                                <tfoot>
                                    <!-- æ€»è®¡è¡Œå’Œç­›é€‰ç»“æœè¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è´§æ¬¾æ”¯ä»˜é¡µé¢ -->
            <div id="payment-page" class="page">
                <div class="card">
                    <div class="card-header">è´§æ¬¾æ”¯ä»˜</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ—¥æœŸ</label>
                                <input type="text" id="payment-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ”¶æ¬¾äºº</label>
                                <div class="dropdown">
                                    <input type="text" id="payment-recipient" placeholder="è¾“å…¥æ”¶æ¬¾äºº">
                                    <div class="dropdown-content" id="recipient-dropdown"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>è´¦å·</label>
                                <div class="dropdown">
                                    <input type="text" id="payment-account" placeholder="è¾“å…¥è´¦å·" pattern="[0-9]*">
                                    <div class="dropdown-content" id="account-dropdown"></div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label>æ”¯ä»˜æ–¹å¼</label>
                                <select id="payment-method">
                                    <option value="">é€‰æ‹©æ”¯ä»˜æ–¹å¼</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>é‡‘é¢(Â¥)</label>
                                <input type="text" id="payment-amount" placeholder="è¾“å…¥é‡‘é¢">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>å¤‡æ³¨</label>
                                <input type="text" id="payment-notes" placeholder="è¾“å…¥å¤‡æ³¨">
                            </div>
                        </div>
                        <button class="btn" id="add-payment">æ·»åŠ è®°å½•</button>
                        
                        <div class="table-actions">
                            <div>
                                <button class="btn" id="select-all-payments">å…¨é€‰</button>
                                <button class="btn" id="deselect-all-payments">å–æ¶ˆå…¨é€‰</button>
                            </div>
                            <div>
                                <button class="btn" id="clear-filter-payments">å–æ¶ˆç­›é€‰</button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table id="payment-table">
                                <thead>
                                    <tr>
                                        <th class="checkbox-cell"><input type="checkbox" id="payments-check-all"></th>
                                        <th>æ—¥æœŸ <span class="filter-icon">ğŸ”</span></th>
                                        <th>æ”¶æ¬¾äºº <span class="filter-icon">ğŸ”</span></th>
                                        <th>æ”¶æ¬¾æ–¹å¼ <span class="filter-icon">ğŸ”</span></th>
                                        <th>è´¦å· <span class="filter-icon">ğŸ”</span></th>
                                        <th>é‡‘é¢(Â¥) <span class="filter-icon">ğŸ”</span></th>
                                        <th>ç»“ç®— <span class="filter-icon">ğŸ”</span></th>
                                        <th>å¤‡æ³¨ <span class="filter-icon">ğŸ”</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- è´§æ¬¾æ”¯ä»˜è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tbody>
                                <tfoot>
                                    <!-- æ€»è®¡è¡Œå’Œç­›é€‰ç»“æœè¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è®¾ç½®é¡µé¢ -->
            <div id="settings-page" class="page">
                <div class="card">
                    <div class="card-header">ç³»ç»Ÿè®¾ç½®</div>
                    <div class="card-body">
                        <div class="settings-section">
                            <h3>å•†å“æ¸…å•</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>å•†å“åç§°åˆ—è¡¨(æ¯è¡Œä¸€ä¸ª)</label>
                                    <textarea id="product-names-list"></textarea>
                                </div>
                                <div class="form-col">
                                    <label>é¢œè‰²åˆ—è¡¨(æ¯è¡Œä¸€ä¸ª)</label>
                                    <textarea id="colors-list"></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>å•ä½åˆ—è¡¨(æ¯è¡Œä¸€ä¸ª)</label>
                                    <textarea id="units-list"></textarea>
                                </div>
                                <div class="form-col">
                                    <!-- ç©ºç™½åŒºåŸŸ -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>æ”¶æ”¯è®°å½•</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>æ”¶æ”¯ç±»å‹(æ¯è¡Œä¸€ä¸ª)</label>
                                    <textarea id="income-expense-types"></textarea>
                                </div>
                                <div class="form-col">
                                    <label>æ”¶æ”¯å½¢å¼(æ¯è¡Œä¸€ä¸ª)</label>
                                    <textarea id="income-expense-forms"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>è¿è´¹æ”¯å‡º</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>å¸ç§åˆ—è¡¨(æ¯è¡Œä¸€ä¸ª)</label>
                                    <textarea id="currency-list"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>è´§æ¬¾æ”¯ä»˜</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>æ”¶æ¬¾äºº-è´¦å·-æ”¯ä»˜æ–¹å¼å¯¹åº”å…³ç³» (æ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šæ”¶æ¬¾äºº,è´¦å·,æ”¯ä»˜æ–¹å¼)</label>
                                    <textarea id="payment-relations"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <button class="btn" id="save-settings">ä¿å­˜è®¾ç½®</button>
                            </div>
                            <div class="form-col">
                                <button class="btn btn-danger" id="delete-all-data">åˆ é™¤æ‰€æœ‰æ•°æ®</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="nav-item active" data-page="overview-page">
                <i>ğŸ“Š</i>
                <span>æ¦‚è§ˆ</span>
            </div>
            <div class="nav-item" data-page="balance-page">
                <i>ğŸ’°</i>
                <span>è´¦æˆ·ä½™é¢</span>
            </div>
            <div class="nav-item" data-page="products-page">
                <i>ğŸ“¦</i>
                <span>å•†å“æ¸…å•</span>
            </div>
            <div class="nav-item" data-page="shipping-page">
                <i>ğŸšš</i>
                <span>è¿è´¹æ”¯å‡º</span>
            </div>
            <div class="nav-item" data-page="records-page">
                <i>ğŸ“</i>
                <span>æ”¶æ”¯è®°å½•</span>
            </div>
            <div class="nav-item" data-page="payment-page">
                <i>ğŸ’³</i>
                <span>è´§æ¬¾æ”¯ä»˜</span>
            </div>
            <div class="nav-item" data-page="settings-page">
                <i>âš™ï¸</i>
                <span>è®¾ç½®</span>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                this.classList.add('active');
                const pageId = this.getAttribute('data-page');
                document.getElementById(pageId).classList.add('active');
                
                // æ›´æ–°é¡µé¢æ•°æ®
                if (pageId === 'overview-page') {
                    updateOverview();
                } else if (pageId === 'balance-page') {
                    updateBalancePage();
                } else if (pageId === 'products-page') {
                    updateProductTable();
                } else if (pageId === 'shipping-page') {
                    updateShippingTable();
                } else if (pageId === 'records-page') {
                    updateRecordsTable();
                } else if (pageId === 'payment-page') {
                    updatePaymentTable();
                }
            });
        });
        
        // æ ¼å¼åŒ–æ•°å­—ä¸ºåƒåˆ†ä½
        function formatNumber(num) {
            if (!num || isNaN(num)) return '0';
            return parseFloat(num).toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
        }
        
        // ç§»é™¤åƒåˆ†ä½æ ¼å¼
        function unformatNumber(str) {
            if (!str) return 0;
            return parseFloat(str.replace(/,/g, '')) || 0;
        }
        
        // æ—¥æœŸæ ¼å¼åŒ–
        function formatDate(dateStr) {
            if (dateStr.length === 8) {
                return dateStr.substring(0, 4) + '/' + dateStr.substring(4, 6) + '/' + dateStr.substring(6, 8);
            }
            return dateStr;
        }
        
        // åˆå§‹åŒ–æ•°æ®
        function initData() {
            // ä»localStorageåŠ è½½æ•°æ®æˆ–è®¾ç½®é»˜è®¤å€¼
            if (!localStorage.getItem('accountBalances')) {
                localStorage.setItem('accountBalances', JSON.stringify({
                    ozon: 0,
                    wb: 0,
                    individual: 0,
                    cash: 0
                }));
            }
            
            if (!localStorage.getItem('settings')) {
                localStorage.setItem('settings', JSON.stringify({
                    productNames: ['å•†å“A', 'å•†å“B', 'å•†å“C'],
                    colors: ['çº¢è‰²', 'è“è‰²', 'ç»¿è‰²'],
                    units: ['ä¸ª', 'ä»¶', 'ç®±'],
                    incomeExpenseTypes: ['è´¹ç”¨æ”¯å‡º', 'é”€å”®è´§æ¬¾'],
                    incomeExpenseForms: ['ç°é‡‘æ”¯ä»˜', 'å…¬è´¦æ”¯ä»˜', 'ç°é‡‘æ”¶å…¥', 'å…¬è´¦æ”¶å…¥'],
                    currencies: ['äººæ°‘å¸', 'ç¾å…ƒ', 'å¢å¸ƒ'],
                    paymentRelations: ['å¼ ä¸‰,1234567890,é“¶è¡Œè½¬è´¦', 'æå››,0987654321,æ”¯ä»˜å®']
                }));
            }
            
            if (!localStorage.getItem('products')) {
                localStorage.setItem('products', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('shipping')) {
                localStorage.setItem('shipping', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('records')) {
                localStorage.setItem('records', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('payments')) {
                localStorage.setItem('payments', JSON.stringify([]));
            }
            
            // æ›´æ–°æ¦‚è§ˆé¡µé¢æ˜¾ç¤º
            updateOverview();
            
            // æ›´æ–°è®¾ç½®é¡µé¢
            updateSettings();
            
            // æ›´æ–°ä¸‹æ‹‰é€‰é¡¹
            updateDropdownOptions();
            
            // åˆå§‹åŒ–ç°é‡‘ä½™é¢
            updateCashBalance();
        }
        
        // æ›´æ–°æ¦‚è§ˆé¡µé¢
        function updateOverview() {
            const balances = JSON.parse(localStorage.getItem('accountBalances'));
            
            document.getElementById('ozon-balance').textContent = formatNumber(balances.ozon);
            document.getElementById('wb-balance').textContent = formatNumber(balances.wb);
            document.getElementById('individual-balance').textContent = formatNumber(balances.individual);
            document.getElementById('cash-balance').textContent = formatNumber(balances.cash);
            
            const total = balances.ozon + balances.wb + balances.individual + balances.cash;
            document.getElementById('total-balance').textContent = formatNumber(total);
        }
        
        // æ›´æ–°è´¦æˆ·ä½™é¢é¡µé¢
        function updateBalancePage() {
            const balances = JSON.parse(localStorage.getItem('accountBalances'));
            
            document.getElementById('ozon-input').value = balances.ozon;
            document.getElementById('wb-input').value = balances.wb;
            document.getElementById('individual-input').value = balances.individual;
            
            // æ›´æ–°ç°é‡‘ä½™é¢æ˜¾ç¤º
            updateCashBalance();
        }
        
        // æ›´æ–°ç°é‡‘ä½™é¢
        function updateCashBalance() {
            const records = JSON.parse(localStorage.getItem('records'));
            
            // è®¡ç®—æœªç»“ç®—çš„ç°é‡‘æ”¶å…¥æ€»å’Œ
            const cashIncome = records
                .filter(record => record.form === 'ç°é‡‘æ”¶å…¥' && record.settlement === 'æœªç»“ç®—')
                .reduce((sum, record) => sum + record.amount, 0);
            
            // è®¡ç®—æœªç»“ç®—çš„ç°é‡‘æ”¯ä»˜æ€»å’Œ
            const cashExpense = records
                .filter(record => record.form === 'ç°é‡‘æ”¯ä»˜' && record.settlement === 'æœªç»“ç®—')
                .reduce((sum, record) => sum + record.amount, 0);
            
            // è®¡ç®—ç°é‡‘ä½™é¢
            const cashBalance = cashIncome - cashExpense;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('cash-display').textContent = formatNumber(cashBalance);
            
            // æ›´æ–°è´¦æˆ·ä½™é¢æ•°æ®
            const balances = JSON.parse(localStorage.getItem('accountBalances'));
            balances.cash = cashBalance;
            localStorage.setItem('accountBalances', JSON.stringify(balances));
            
            // æ›´æ–°æ¦‚è§ˆé¡µé¢
            updateOverview();
        }
        
        // æ›´æ–°è®¾ç½®é¡µé¢
        function updateSettings() {
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            document.getElementById('product-names-list').value = settings.productNames.join('\n');
            document.getElementById('colors-list').value = settings.colors.join('\n');
            document.getElementById('units-list').value = settings.units.join('\n');
            document.getElementById('income-expense-types').value = settings.incomeExpenseTypes.join('\n');
            document.getElementById('income-expense-forms').value = settings.incomeExpenseForms.join('\n');
            document.getElementById('currency-list').value = settings.currencies.join('\n');
            document.getElementById('payment-relations').value = settings.paymentRelations.join('\n');
        }
        
        // æ›´æ–°ä¸‹æ‹‰é€‰é¡¹
        function updateDropdownOptions() {
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            // æ›´æ–°å•†å“æ¸…å•é¡µé¢çš„ä¸‹æ‹‰é€‰é¡¹
            const colorSelect = document.getElementById('color-select');
            colorSelect.innerHTML = '<option value="">é€‰æ‹©é¢œè‰²</option>';
            settings.colors.forEach(color => {
                const option = document.createElement('option');
                option.value = color;
                option.textContent = color;
                colorSelect.appendChild(option);
            });
            
            const unitSelect = document.getElementById('unit-select');
            unitSelect.innerHTML = '<option value="">é€‰æ‹©å•ä½</option>';
            settings.units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                option.textContent = unit;
                unitSelect.appendChild(option);
            });
            
            // æ›´æ–°è¿è´¹æ”¯å‡ºé¡µé¢çš„ä¸‹æ‹‰é€‰é¡¹
            const currencySelect = document.getElementById('shipping-currency');
            currencySelect.innerHTML = '<option value="">é€‰æ‹©å¸ç§</option>';
            settings.currencies.forEach(currency => {
                const option = document.createElement('option');
                option.value = currency;
                option.textContent = currency;
                currencySelect.appendChild(option);
            });
            
            // æ›´æ–°æ”¶æ”¯è®°å½•é¡µé¢çš„ä¸‹æ‹‰é€‰é¡¹
            const recordTypeSelect = document.getElementById('record-type');
            recordTypeSelect.innerHTML = '<option value="">é€‰æ‹©æ”¶æ”¯ç±»å‹</option>';
            settings.incomeExpenseTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                recordTypeSelect.appendChild(option);
            });
            
            const recordFormSelect = document.getElementById('record-form');
            recordFormSelect.innerHTML = '<option value="">é€‰æ‹©æ”¶æ”¯å½¢å¼</option>';
            settings.incomeExpenseForms.forEach(form => {
                const option = document.createElement('option');
                option.value = form;
                option.textContent = form;
                recordFormSelect.appendChild(option);
            });
            
            // æ›´æ–°è´§æ¬¾æ”¯ä»˜é¡µé¢çš„ä¸‹æ‹‰é€‰é¡¹
            const paymentMethodSelect = document.getElementById('payment-method');
            paymentMethodSelect.innerHTML = '<option value="">é€‰æ‹©æ”¯ä»˜æ–¹å¼</option>';
            const paymentMethods = [...new Set(settings.paymentRelations.map(rel => {
                const parts = rel.split(',');
                return parts.length > 2 ? parts[2] : '';
            }))].filter(method => method);
            
            paymentMethods.forEach(method => {
                const option = document.createElement('option');
                option.value = method;
                option.textContent = method;
                paymentMethodSelect.appendChild(option);
            });
        }
        
        // ä¿å­˜è´¦æˆ·ä½™é¢
        document.getElementById('save-balance').addEventListener('click', function() {
            const ozonValue = unformatNumber(document.getElementById('ozon-input').value) || 0;
            const wbValue = unformatNumber(document.getElementById('wb-input').value) || 0;
            const individualValue = unformatNumber(document.getElementById('individual-input').value) || 0;
            
            const balances = {
                ozon: ozonValue,
                wb: wbValue,
                individual: individualValue,
                cash: 0 // ç°é‡‘ä½™é¢é€šè¿‡å…¶ä»–é¡µé¢è®¡ç®—
            };
            
            localStorage.setItem('accountBalances', JSON.stringify(balances));
            updateOverview();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('ozon-input').value = '';
            document.getElementById('wb-input').value = '';
            document.getElementById('individual-input').value = '';
            
            alert('è´¦æˆ·ä½™é¢å·²ä¿å­˜ï¼');
        });
        
        // ä¿å­˜è®¾ç½®
        document.getElementById('save-settings').addEventListener('click', function() {
            const settings = {
                productNames: document.getElementById('product-names-list').value.split('\n').filter(item => item.trim()),
                colors: document.getElementById('colors-list').value.split('\n').filter(item => item.trim()),
                units: document.getElementById('units-list').value.split('\n').filter(item => item.trim()),
                incomeExpenseTypes: document.getElementById('income-expense-types').value.split('\n').filter(item => item.trim()),
                incomeExpenseForms: document.getElementById('income-expense-forms').value.split('\n').filter(item => item.trim()),
                currencies: document.getElementById('currency-list').value.split('\n').filter(item => item.trim()),
                paymentRelations: document.getElementById('payment-relations').value.split('\n').filter(item => item.trim())
            };
            
            localStorage.setItem('settings', JSON.stringify(settings));
            updateDropdownOptions();
            alert('è®¾ç½®å·²ä¿å­˜ï¼');
        });
        
        // åˆ é™¤æ‰€æœ‰æ•°æ®
        document.getElementById('delete-all-data').addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.clear();
                initData();
                alert('æ‰€æœ‰æ•°æ®å·²åˆ é™¤ï¼');
            }
        });
        
        // å•†å“åç§°æ™ºèƒ½è¾“å…¥
        document.getElementById('product-name').addEventListener('input', function() {
            const input = this.value;
            const dropdown = document.getElementById('product-name-dropdown');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            dropdown.innerHTML = '';
            
            if (input.length > 0) {
                const matches = settings.productNames.filter(name => 
                    name.toLowerCase().includes(input.toLowerCase())
                );
                
                matches.forEach(match => {
                    const div = document.createElement('div');
                    div.textContent = match;
                    div.addEventListener('click', function() {
                        document.getElementById('product-name').value = match;
                        dropdown.style.display = 'none';
                    });
                    dropdown.appendChild(div);
                });
                
                if (matches.length > 0) {
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            } else {
                dropdown.style.display = 'none';
            }
        });
        
        // æ—¥æœŸè¾“å…¥æ ¼å¼åŒ–
        document.querySelectorAll('input[placeholder="YYYYMMDD"]').forEach(input => {
            input.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                
                if (value.length > 8) {
                    value = value.substring(0, 8);
                }
                
                if (value.length === 8) {
                    this.value = formatDate(value);
                } else {
                    this.value = value;
                }
            });
        });
        
        // è®¡ç®—å•†å“é‡‘é¢
        function calculateProductAmounts() {
            const quantity = unformatNumber(document.getElementById('quantity').value) || 0;
            const unitPrice = unformatNumber(document.getElementById('unit-price').value) || 0;
            const exchangeRate = unformatNumber(document.getElementById('exchange-rate').value) || 0;
            
            // è®¡ç®—é‡‘é¢(Â¥)
            const cnyAmount = quantity * unitPrice;
            document.getElementById('cny-amount').textContent = formatNumber(cnyAmount);
            
            // è®¡ç®—æŠ˜åˆå¢å¸ƒ
            let rublePrice = 0;
            if (exchangeRate > 1) {
                rublePrice = unitPrice * exchangeRate;
            } else if (exchangeRate > 0) {
                rublePrice = unitPrice / exchangeRate;
            }
            document.getElementById('ruble-price').textContent = formatNumber(rublePrice);
            
            // è®¡ç®—é‡‘é¢(â‚½)
            const rubleAmount = quantity * rublePrice;
            document.getElementById('ruble-amount').textContent = formatNumber(rubleAmount);
        }
        
        // ç›‘å¬æ•°é‡ã€å•ä»·ã€æ±‡ç‡å˜åŒ–
        document.getElementById('quantity').addEventListener('input', calculateProductAmounts);
        document.getElementById('unit-price').addEventListener('input', calculateProductAmounts);
        document.getElementById('exchange-rate').addEventListener('input', calculateProductAmounts);
        
        // æ·»åŠ å•†å“
        document.getElementById('add-product').addEventListener('click', function() {
            // éªŒè¯å¿…å¡«é¡¹
            const arrivalDate = document.getElementById('arrival-date').value;
            const productName = document.getElementById('product-name').value;
            const quantity = document.getElementById('quantity').value;
            const unitPrice = document.getElementById('unit-price').value;
            const exchangeRate = document.getElementById('exchange-rate').value;
            
            if (!arrivalDate || !productName || !quantity || !unitPrice || !exchangeRate) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼');
                return;
            }
            
            // è·å–å…¶ä»–å­—æ®µå€¼
            const color = document.getElementById('color-select').value;
            const unit = document.getElementById('unit-select').value;
            const description = document.getElementById('product-description').value;
            
            // è®¡ç®—é‡‘é¢
            const cnyAmount = unformatNumber(document.getElementById('cny-amount').textContent);
            const rublePrice = unformatNumber(document.getElementById('ruble-price').textContent);
            const rubleAmount = unformatNumber(document.getElementById('ruble-amount').textContent);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const products = JSON.parse(localStorage.getItem('products'));
            products.push({
                date: arrivalDate,
                productName,
                color,
                quantity: unformatNumber(quantity),
                unit,
                unitPrice: unformatNumber(unitPrice),
                cnyAmount,
                exchangeRate: unformatNumber(exchangeRate),
                rublePrice,
                rubleAmount,
                description
            });
            localStorage.setItem('products', JSON.stringify(products));
            
            // æ›´æ–°è¡¨æ ¼
            updateProductTable();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('arrival-date').value = '';
            document.getElementById('product-name').value = '';
            document.getElementById('color-select').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('unit-select').value = '';
            document.getElementById('unit-price').value = '';
            document.getElementById('exchange-rate').value = '';
            document.getElementById('product-description').value = '';
            document.getElementById('ruble-price').textContent = '0';
            document.getElementById('cny-amount').textContent = '0';
            document.getElementById('ruble-amount').textContent = '0';
            
            alert('å•†å“å·²æ·»åŠ ï¼');
        });
        
        // æ›´æ–°å•†å“è¡¨æ ¼
        function updateProductTable() {
            const products = JSON.parse(localStorage.getItem('products'));
            const tableBody = document.querySelector('#products-table tbody');
            const tableFoot = document.querySelector('#products-table tfoot');
            tableBody.innerHTML = '';
            tableFoot.innerHTML = '';
            
            // æ·»åŠ è¡¨æ ¼è¡Œ
            products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell"><input type="checkbox" class="product-checkbox" data-index="${index}"></td>
                    <td>${product.date}</td>
                    <td>${product.productName}</td>
                    <td>${product.color}</td>
                    <td>${formatNumber(product.quantity)}</td>
                    <td>${product.unit}</td>
                    <td>${formatNumber(product.unitPrice)}</td>
                    <td>${formatNumber(product.cnyAmount)}</td>
                    <td>${formatNumber(product.exchangeRate)}</td>
                    <td>${formatNumber(product.rublePrice)}</td>
                    <td>${formatNumber(product.rubleAmount)}</td>
                    <td class="description-cell editable-cell" contenteditable="true" data-index="${index}" data-field="description">${product.description}</td>
                `;
                tableBody.appendChild(row);
            });
            
            // æ·»åŠ æ€»è®¡è¡Œ
            if (products.length > 0) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'table-total';
                
                // è®¡ç®—æ€»è®¡
                const totalQuantity = products.reduce((sum, product) => sum + product.quantity, 0);
                const totalCnyAmount = products.reduce((sum, product) => sum + product.cnyAmount, 0);
                const totalRubleAmount = products.reduce((sum, product) => sum + product.rubleAmount, 0);
                
                totalRow.innerHTML = `
                    <td colspan="4">æ€»è®¡</td>
                    <td>${formatNumber(totalQuantity)}</td>
                    <td></td>
                    <td></td>
                    <td>${formatNumber(totalCnyAmount)}</td>
                    <td></td>
                    <td></td>
                    <td>${formatNumber(totalRubleAmount)}</td>
                    <td></td>
                `;
                tableFoot.appendChild(totalRow);
            }
            
            // æ·»åŠ ç­›é€‰ç»“æœè¡Œ
            const filterRow = document.createElement('tr');
            filterRow.className = 'table-filter-result';
            filterRow.innerHTML = `<td colspan="12">å…± ${products.length} æ¡è®°å½•</td>`;
            tableFoot.appendChild(filterRow);
            
            // æ·»åŠ å‹¾é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
                    updateCheckAllState('products');
                });
            });
            
            // æ·»åŠ å…¨é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.getElementById('products-check-all').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
            });
            
            // æ·»åŠ å¯ç¼–è¾‘å•å…ƒæ ¼äº‹ä»¶ç›‘å¬
            document.querySelectorAll('#products-table .editable-cell').forEach(cell => {
                cell.addEventListener('blur', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const field = this.getAttribute('data-field');
                    const value = this.textContent;
                    
                    const products = JSON.parse(localStorage.getItem('products'));
                    products[index][field] = value;
                    localStorage.setItem('products', JSON.stringify(products));
                });
            });
        }
        
        // å•†å“æ¸…å•å…¨é€‰/å–æ¶ˆå…¨é€‰
        document.getElementById('select-all-products').addEventListener('click', function() {
            document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            document.getElementById('products-check-all').checked = true;
        });
        
        document.getElementById('deselect-all-products').addEventListener('click', function() {
            document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('products-check-all').checked = false;
        });
        
        // å•†å“æ¸…å•å–æ¶ˆç­›é€‰
        document.getElementById('clear-filter-products').addEventListener('click', function() {
            // è¿™é‡Œå¯ä»¥å®ç°ç­›é€‰é€»è¾‘ï¼Œç›®å‰åªæ˜¯é‡æ–°åŠ è½½è¡¨æ ¼
            updateProductTable();
            alert('ç­›é€‰å·²å–æ¶ˆï¼');
        });
        
        // è®¡ç®—è¿è´¹
        function calculateShipping() {
            const shippingFee = unformatNumber(document.getElementById('shipping-fee').value) || 0;
            const exchangeRate = unformatNumber(document.getElementById('shipping-exchange-rate').value) || 0;
            const currency = document.getElementById('shipping-currency').value;
            
            // è®¡ç®—æŠ˜åˆå¢å¸ƒ
            let rubleEquivalent = 0;
            if (currency !== 'å¢å¸ƒ') {
                if (exchangeRate > 1) {
                    rubleEquivalent = shippingFee * exchangeRate;
                } else if (exchangeRate > 0) {
                    rubleEquivalent = shippingFee / exchangeRate;
                }
            } else {
                rubleEquivalent = shippingFee;
            }
            document.getElementById('shipping-ruble').textContent = formatNumber(rubleEquivalent);
            
            // è®¡ç®—è¿è´¹æ€»è®¡
            const palletFee = unformatNumber(document.getElementById('pallet-fee').value) || 0;
            const cubeFee = unformatNumber(document.getElementById('cube-fee').value) || 0;
            const deliveryFee = unformatNumber(document.getElementById('delivery-fee').value) || 0;
            
            const shippingTotal = rubleEquivalent + palletFee + cubeFee + deliveryFee;
            document.getElementById('shipping-total').textContent = formatNumber(shippingTotal);
            
            // æ˜¾ç¤º/éšè—æŠ˜åˆå¢å¸ƒæ¡†
            if (currency === 'å¢å¸ƒ') {
                document.getElementById('shipping-ruble').classList.add('hidden');
                document.querySelector('label[for="shipping-ruble"]').classList.add('hidden');
            } else {
                document.getElementById('shipping-ruble').classList.remove('hidden');
                document.querySelector('label[for="shipping-ruble"]').classList.remove('hidden');
            }
        }
        
        // ç›‘å¬è¿è´¹ç›¸å…³è¾“å…¥å˜åŒ–
        document.getElementById('shipping-fee').addEventListener('input', calculateShipping);
        document.getElementById('shipping-exchange-rate').addEventListener('input', calculateShipping);
        document.getElementById('shipping-currency').addEventListener('change', calculateShipping);
        document.getElementById('pallet-fee').addEventListener('input', calculateShipping);
        document.getElementById('cube-fee').addEventListener('input', calculateShipping);
        document.getElementById('delivery-fee').addEventListener('input', calculateShipping);
        
        // æ·»åŠ è¿è´¹
        document.getElementById('add-shipping').addEventListener('click', function() {
            // éªŒè¯å¿…å¡«é¡¹
            const date = document.getElementById('shipping-date').value;
            const productName = document.getElementById('shipping-product').value;
            const weight = document.getElementById('shipping-weight').value;
            const shippingFee = document.getElementById('shipping-fee').value;
            
            if (!date || !productName || !weight || !shippingFee) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼');
                return;
            }
            
            // è·å–å…¶ä»–å­—æ®µå€¼
            const shippingCode = document.getElementById('shipping-code').value;
            const volume = document.getElementById('shipping-volume').value;
            const quantity = document.getElementById('shipping-quantity').value;
            const currency = document.getElementById('shipping-currency').value;
            const exchangeRate = document.getElementById('shipping-exchange-rate').value;
            const palletFee = document.getElementById('pallet-fee').value;
            const cubeFee = document.getElementById('cube-fee').value;
            const deliveryFee = document.getElementById('delivery-fee').value;
            const notes = document.getElementById('shipping-notes').value;
            
            // è®¡ç®—å€¼
            const rubleEquivalent = unformatNumber(document.getElementById('shipping-ruble').textContent);
            const shippingTotal = unformatNumber(document.getElementById('shipping-total').textContent);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const shipping = JSON.parse(localStorage.getItem('shipping'));
            shipping.push({
                date,
                productName,
                shippingCode,
                quantity: unformatNumber(quantity),
                weight: unformatNumber(weight),
                volume: unformatNumber(volume),
                shippingFee: unformatNumber(shippingFee),
                currency,
                exchangeRate: unformatNumber(exchangeRate),
                rubleEquivalent,
                palletFee: unformatNumber(palletFee),
                cubeFee: unformatNumber(cubeFee),
                deliveryFee: unformatNumber(deliveryFee),
                shippingTotal,
                settlement: 'æœªç»“ç®—',
                notes
            });
            localStorage.setItem('shipping', JSON.stringify(shipping));
            
            // æ›´æ–°è¡¨æ ¼
            updateShippingTable();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('shipping-date').value = '';
            document.getElementById('shipping-code').value = '';
            document.getElementById('shipping-product').value = '';
            document.getElementById('shipping-weight').value = '';
            document.getElementById('shipping-volume').value = '';
            document.getElementById('shipping-quantity').value = '';
            document.getElementById('shipping-fee').value = '';
            document.getElementById('shipping-currency').value = '';
            document.getElementById('shipping-exchange-rate').value = '';
            document.getElementById('pallet-fee').value = '';
            document.getElementById('cube-fee').value = '';
            document.getElementById('delivery-fee').value = '';
            document.getElementById('shipping-notes').value = '';
            document.getElementById('shipping-ruble').textContent = '0';
            document.getElementById('shipping-total').textContent = '0';
            
            alert('è¿è´¹è®°å½•å·²æ·»åŠ ï¼');
        });
        
        // æ›´æ–°è¿è´¹è¡¨æ ¼
        function updateShippingTable() {
            const shipping = JSON.parse(localStorage.getItem('shipping'));
            const tableBody = document.querySelector('#shipping-table tbody');
            const tableFoot = document.querySelector('#shipping-table tfoot');
            tableBody.innerHTML = '';
            tableFoot.innerHTML = '';
            
            // æ·»åŠ è¡¨æ ¼è¡Œ
            shipping.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell"><input type="checkbox" class="shipping-checkbox" data-index="${index}"></td>
                    <td>${item.date}</td>
                    <td>${item.productName}</td>
                    <td>${item.shippingCode}</td>
                    <td>${formatNumber(item.quantity)}</td>
                    <td>${formatNumber(item.weight)}</td>
                    <td>${formatNumber(item.volume)}</td>
                    <td>${formatNumber(item.shippingFee)}</td>
                    <td>${item.currency}</td>
                    <td>${formatNumber(item.rubleEquivalent)}</td>
                    <td>${formatNumber(item.palletFee)}</td>
                    <td>${formatNumber(item.cubeFee)}</td>
                    <td>${formatNumber(item.deliveryFee)}</td>
                    <td>${formatNumber(item.shippingTotal)}</td>
                    <td>
                        <select class="settlement-select" data-index="${index}">
                            <option value="æœªç»“ç®—" ${item.settlement === 'æœªç»“ç®—' ? 'selected' : ''}>æœªç»“ç®—</option>
                            <option value="å·²ç»“ç®—" ${item.settlement === 'å·²ç»“ç®—' ? 'selected' : ''}>å·²ç»“ç®—</option>
                        </select>
                    </td>
                    <td class="notes-cell editable-cell" contenteditable="true" data-index="${index}" data-field="notes">${item.notes}</td>
                `;
                tableBody.appendChild(row);
            });
            
            // æ·»åŠ æ€»è®¡è¡Œ
            if (shipping.length > 0) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'table-total';
                
                // è®¡ç®—æ€»è®¡
                const totalQuantity = shipping.reduce((sum, item) => sum + item.quantity, 0);
                const totalWeight = shipping.reduce((sum, item) => sum + item.weight, 0);
                const totalVolume = shipping.reduce((sum, item) => sum + item.volume, 0);
                const totalShippingFee = shipping.reduce((sum, item) => sum + item.shippingFee, 0);
                const totalRubleEquivalent = shipping.reduce((sum, item) => sum + item.rubleEquivalent, 0);
                const totalPalletFee = shipping.reduce((sum, item) => sum + item.palletFee, 0);
                const totalCubeFee = shipping.reduce((sum, item) => sum + item.cubeFee, 0);
                const totalDeliveryFee = shipping.reduce((sum, item) => sum + item.deliveryFee, 0);
                const totalShippingTotal = shipping.reduce((sum, item) => sum + item.shippingTotal, 0);
                
                totalRow.innerHTML = `
                    <td colspan="4">æ€»è®¡</td>
                    <td>${formatNumber(totalQuantity)}</td>
                    <td>${formatNumber(totalWeight)}</td>
                    <td>${formatNumber(totalVolume)}</td>
                    <td>${formatNumber(totalShippingFee)}</td>
                    <td></td>
                    <td>${formatNumber(totalRubleEquivalent)}</td>
                    <td>${formatNumber(totalPalletFee)}</td>
                    <td>${formatNumber(totalCubeFee)}</td>
                    <td>${formatNumber(totalDeliveryFee)}</td>
                    <td>${formatNumber(totalShippingTotal)}</td>
                    <td></td>
                    <td></td>
                `;
                tableFoot.appendChild(totalRow);
            }
            
            // æ·»åŠ ç­›é€‰ç»“æœè¡Œ
            const filterRow = document.createElement('tr');
            filterRow.className = 'table-filter-result';
            filterRow.innerHTML = `<td colspan="16">å…± ${shipping.length} æ¡è®°å½•</td>`;
            tableFoot.appendChild(filterRow);
            
            // æ·»åŠ å‹¾é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.shipping-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
                    updateCheckAllState('shipping');
                });
            });
            
            // æ·»åŠ å…¨é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.getElementById('shipping-check-all').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.shipping-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
            });
            
            // æ·»åŠ ç»“ç®—çŠ¶æ€é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            document.querySelectorAll('#shipping-table .settlement-select').forEach(select => {
                select.addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const value = this.value;
                    
                    const shipping = JSON.parse(localStorage.getItem('shipping'));
                    shipping[index].settlement = value;
                    localStorage.setItem('shipping', JSON.stringify(shipping));
                    
                    // æ›´æ–°ç°é‡‘ä½™é¢
                    updateCashBalance();
                });
            });
            
            // æ·»åŠ å¯ç¼–è¾‘å•å…ƒæ ¼äº‹ä»¶ç›‘å¬
            document.querySelectorAll('#shipping-table .editable-cell').forEach(cell => {
                cell.addEventListener('blur', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const field = this.getAttribute('data-field');
                    const value = this.textContent;
                    
                    const shipping = JSON.parse(localStorage.getItem('shipping'));
                    shipping[index][field] = value;
                    localStorage.setItem('shipping', JSON.stringify(shipping));
                });
            });
        }
        
        // è¿è´¹æ”¯å‡ºå…¨é€‰/å–æ¶ˆå…¨é€‰
        document.getElementById('select-all-shipping').addEventListener('click', function() {
            document.querySelectorAll('.shipping-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            document.getElementById('shipping-check-all').checked = true;
        });
        
        document.getElementById('deselect-all-shipping').addEventListener('click', function() {
            document.querySelectorAll('.shipping-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('shipping-check-all').checked = false;
        });
        
        // è¿è´¹æ”¯å‡ºå–æ¶ˆç­›é€‰
        document.getElementById('clear-filter-shipping').addEventListener('click', function() {
            // è¿™é‡Œå¯ä»¥å®ç°ç­›é€‰é€»è¾‘ï¼Œç›®å‰åªæ˜¯é‡æ–°åŠ è½½è¡¨æ ¼
            updateShippingTable();
            alert('ç­›é€‰å·²å–æ¶ˆï¼');
        });
        
        // æ”¶æ”¯ç±»å‹å’Œå½¢å¼çš„å…³è”
        document.getElementById('record-type').addEventListener('change', function() {
            const type = this.value;
            const formSelect = document.getElementById('record-form');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            formSelect.innerHTML = '<option value="">é€‰æ‹©æ”¶æ”¯å½¢å¼</option>';
            
            if (type === 'è´¹ç”¨æ”¯å‡º') {
                settings.incomeExpenseForms.forEach(form => {
                    if (form === 'ç°é‡‘æ”¯ä»˜' || form === 'å…¬è´¦æ”¯ä»˜') {
                        const option = document.createElement('option');
                        option.value = form;
                        option.textContent = form;
                        formSelect.appendChild(option);
                    }
                });
            } else if (type === 'é”€å”®è´§æ¬¾') {
                settings.incomeExpenseForms.forEach(form => {
                    if (form === 'ç°é‡‘æ”¶å…¥' || form === 'å…¬è´¦æ”¶å…¥') {
                        const option = document.createElement('option');
                        option.value = form;
                        option.textContent = form;
                        formSelect.appendChild(option);
                    }
                });
            } else {
                settings.incomeExpenseForms.forEach(form => {
                    const option = document.createElement('option');
                    option.value = form;
                    option.textContent = form;
                    formSelect.appendChild(option);
                });
            }
        });
        
        // æ·»åŠ æ”¶æ”¯è®°å½•
        document.getElementById('add-record').addEventListener('click', function() {
            // éªŒè¯å¿…å¡«é¡¹
            const date = document.getElementById('record-date').value;
            const type = document.getElementById('record-type').value;
            const form = document.getElementById('record-form').value;
            const amount = document.getElementById('record-amount').value;
            const description = document.getElementById('record-description').value;
            
            if (!date || !type || !form || !amount || !description) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼');
                return;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const records = JSON.parse(localStorage.getItem('records'));
            records.push({
                date,
                type,
                form,
                amount: unformatNumber(amount),
                settlement: 'æœªç»“ç®—',
                description
            });
            localStorage.setItem('records', JSON.stringify(records));
            
            // æ›´æ–°è¡¨æ ¼
            updateRecordsTable();
            
            // æ›´æ–°ç°é‡‘ä½™é¢
            updateCashBalance();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('record-date').value = '';
            document.getElementById('record-type').value = '';
            document.getElementById('record-form').value = '';
            document.getElementById('record-amount').value = '';
            document.getElementById('record-description').value = '';
            
            alert('æ”¶æ”¯è®°å½•å·²æ·»åŠ ï¼');
        });
        
        // æ›´æ–°æ”¶æ”¯è®°å½•è¡¨æ ¼
        function updateRecordsTable() {
            const records = JSON.parse(localStorage.getItem('records'));
            const tableBody = document.querySelector('#records-table tbody');
            const tableFoot = document.querySelector('#records-table tfoot');
            tableBody.innerHTML = '';
            tableFoot.innerHTML = '';
            
            // æ·»åŠ è¡¨æ ¼è¡Œ
            records.forEach((record, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell"><input type="checkbox" class="record-checkbox" data-index="${index}"></td>
                    <td>${record.date}</td>
                    <td>${record.type}</td>
                    <td>${record.form}</td>
                    <td>${formatNumber(record.amount)}</td>
                    <td>
                        <select class="settlement-select" data-index="${index}">
                            <option value="æœªç»“ç®—" ${record.settlement === 'æœªç»“ç®—' ? 'selected' : ''}>æœªç»“ç®—</option>
                            <option value="å·²ç»“ç®—" ${record.settlement === 'å·²ç»“ç®—' ? 'selected' : ''}>å·²ç»“ç®—</option>
                        </select>
                    </td>
                    <td class="description-cell editable-cell" contenteditable="true" data-index="${index}" data-field="description">${record.description}</td>
                `;
                tableBody.appendChild(row);
            });
            
            // æ·»åŠ æ€»è®¡è¡Œ
            if (records.length > 0) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'table-total';
                
                // è®¡ç®—æ€»è®¡
                const totalAmount = records.reduce((sum, record) => sum + record.amount, 0);
                
                totalRow.innerHTML = `
                    <td colspan="4">æ€»è®¡</td>
                    <td>${formatNumber(totalAmount)}</td>
                    <td></td>
                    <td></td>
                `;
                tableFoot.appendChild(totalRow);
            }
            
            // æ·»åŠ ç­›é€‰ç»“æœè¡Œ
            const filterRow = document.createElement('tr');
            filterRow.className = 'table-filter-result';
            filterRow.innerHTML = `<td colspan="7">å…± ${records.length} æ¡è®°å½•</td>`;
            tableFoot.appendChild(filterRow);
            
            // æ·»åŠ å‹¾é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.record-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
                    updateCheckAllState('records');
                });
            });
            
            // æ·»åŠ å…¨é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.getElementById('records-check-all').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.record-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
            });
            
            // æ·»åŠ ç»“ç®—çŠ¶æ€é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            document.querySelectorAll('#records-table .settlement-select').forEach(select => {
                select.addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const value = this.value;
                    
                    const records = JSON.parse(localStorage.getItem('records'));
                    records[index].settlement = value;
                    localStorage.setItem('records', JSON.stringify(records));
                    
                    // æ›´æ–°ç°é‡‘ä½™é¢
                    updateCashBalance();
                });
            });
            
            // æ·»åŠ å¯ç¼–è¾‘å•å…ƒæ ¼äº‹ä»¶ç›‘å¬
            document.querySelectorAll('#records-table .editable-cell').forEach(cell => {
                cell.addEventListener('blur', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const field = this.getAttribute('data-field');
                    const value = this.textContent;
                    
                    const records = JSON.parse(localStorage.getItem('records'));
                    records[index][field] = value;
                    localStorage.setItem('records', JSON.stringify(records));
                });
            });
        }
        
        // æ”¶æ”¯è®°å½•å…¨é€‰/å–æ¶ˆå…¨é€‰
        document.getElementById('select-all-records').addEventListener('click', function() {
            document.querySelectorAll('.record-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            document.getElementById('records-check-all').checked = true;
        });
        
        document.getElementById('deselect-all-records').addEventListener('click', function() {
            document.querySelectorAll('.record-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('records-check-all').checked = false;
        });
        
        // æ”¶æ”¯è®°å½•å–æ¶ˆç­›é€‰
        document.getElementById('clear-filter-records').addEventListener('click', function() {
            // è¿™é‡Œå¯ä»¥å®ç°ç­›é€‰é€»è¾‘ï¼Œç›®å‰åªæ˜¯é‡æ–°åŠ è½½è¡¨æ ¼
            updateRecordsTable();
            alert('ç­›é€‰å·²å–æ¶ˆï¼');
        });
        
        // æ”¶æ¬¾äººæ™ºèƒ½è¾“å…¥
        document.getElementById('payment-recipient').addEventListener('input', function() {
            const input = this.value;
            const dropdown = document.getElementById('recipient-dropdown');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            dropdown.innerHTML = '';
            
            if (input.length > 0) {
                const matches = settings.paymentRelations.filter(rel => {
                    const parts = rel.split(',');
                    return parts.length > 0 && parts[0].toLowerCase().includes(input.toLowerCase());
                });
                
                matches.forEach(match => {
                    const parts = match.split(',');
                    const div = document.createElement('div');
                    div.textContent = parts[0];
                    div.addEventListener('click', function() {
                        document.getElementById('payment-recipient').value = parts[0];
                        if (parts.length > 1) {
                            document.getElementById('payment-account').value = parts[1];
                        }
                        if (parts.length > 2) {
                            document.getElementById('payment-method').value = parts[2];
                        }
                        dropdown.style.display = 'none';
                    });
                    dropdown.appendChild(div);
                });
                
                if (matches.length > 0) {
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            } else {
                dropdown.style.display = 'none';
            }
        });
        
        // è´¦å·ä¸‹æ‹‰åˆ—è¡¨
        document.getElementById('payment-recipient').addEventListener('change', function() {
            const recipient = this.value;
            const accountDropdown = document.getElementById('account-dropdown');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            accountDropdown.innerHTML = '';
            
            if (recipient) {
                const matches = settings.paymentRelations.filter(rel => {
                    const parts = rel.split(',');
                    return parts.length > 0 && parts[0] === recipient;
                });
                
                matches.forEach(match => {
                    const parts = match.split(',');
                    if (parts.length > 1) {
                        const div = document.createElement('div');
                        div.textContent = parts[1];
                        div.addEventListener('click', function() {
                            document.getElementById('payment-account').value = parts[1];
                            if (parts.length > 2) {
                                document.getElementById('payment-method').value = parts[2];
                            }
                            accountDropdown.style.display = 'none';
                        });
                        accountDropdown.appendChild(div);
                    }
                });
                
                if (matches.length > 0) {
                    accountDropdown.style.display = 'block';
                } else {
                    accountDropdown.style.display = 'none';
                }
            } else {
                accountDropdown.style.display = 'none';
            }
        });
        
        // æ·»åŠ è´§æ¬¾æ”¯ä»˜è®°å½•
        document.getElementById('add-payment').addEventListener('click', function() {
            // éªŒè¯å¿…å¡«é¡¹
            const date = document.getElementById('payment-date').value;
            const recipient = document.getElementById('payment-recipient').value;
            const account = document.getElementById('payment-account').value;
            const method = document.getElementById('payment-method').value;
            const amount = document.getElementById('payment-amount').value;
            
            if (!date || !recipient || !account || !method || !amount) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼');
                return;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const payments = JSON.parse(localStorage.getItem('payments'));
            payments.push({
                date,
                recipient,
                method,
                account,
                amount: unformatNumber(amount),
                settlement: 'æœªç»“ç®—',
                notes: document.getElementById('payment-notes').value
            });
            localStorage.setItem('payments', JSON.stringify(payments));
            
            // å¦‚æœæ”¶æ¬¾äººä¸åœ¨è®¾ç½®ä¸­ï¼Œåˆ™æ·»åŠ åˆ°è®¾ç½®
            const settings = JSON.parse(localStorage.getItem('settings'));
            const relation = `${recipient},${account},${method}`;
            if (!settings.paymentRelations.includes(relation)) {
                settings.paymentRelations.push(relation);
                localStorage.setItem('settings', JSON.stringify(settings));
                updateDropdownOptions();
            }
            
            // æ›´æ–°è¡¨æ ¼
            updatePaymentTable();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('payment-date').value = '';
            document.getElementById('payment-recipient').value = '';
            document.getElementById('payment-account').value = '';
            document.getElementById('payment-method').value = '';
            document.getElementById('payment-amount').value = '';
            document.getElementById('payment-notes').value = '';
            
            alert('è´§æ¬¾æ”¯ä»˜è®°å½•å·²æ·»åŠ ï¼');
        });
        
        // æ›´æ–°è´§æ¬¾æ”¯ä»˜è¡¨æ ¼
        function updatePaymentTable() {
            const payments = JSON.parse(localStorage.getItem('payments'));
            const tableBody = document.querySelector('#payment-table tbody');
            const tableFoot = document.querySelector('#payment-table tfoot');
            tableBody.innerHTML = '';
            tableFoot.innerHTML = '';
            
            // æ·»åŠ è¡¨æ ¼è¡Œ
            payments.forEach((payment, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell"><input type="checkbox" class="payment-checkbox" data-index="${index}"></td>
                    <td>${payment.date}</td>
                    <td>${payment.recipient}</td>
                    <td>${payment.method}</td>
                    <td>${payment.account}</td>
                    <td>${formatNumber(payment.amount)}</td>
                    <td>
                        <select class="settlement-select" data-index="${index}">
                            <option value="æœªç»“ç®—" ${payment.settlement === 'æœªç»“ç®—' ? 'selected' : ''}>æœªç»“ç®—</option>
                            <option value="å·²ç»“ç®—" ${payment.settlement === 'å·²ç»“ç®—' ? 'selected' : ''}>å·²ç»“ç®—</option>
                        </select>
                    </td>
                    <td class="notes-cell editable-cell" contenteditable="true" data-index="${index}" data-field="notes">${payment.notes}</td>
                `;
                tableBody.appendChild(row);
            });
            
            // æ·»åŠ æ€»è®¡è¡Œ
            if (payments.length > 0) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'table-total';
                
                // è®¡ç®—æ€»è®¡
                const totalAmount = payments.reduce((sum, payment) => sum + payment.amount, 0);
                
                totalRow.innerHTML = `
                    <td colspan="5">æ€»è®¡</td>
                    <td>${formatNumber(totalAmount)}</td>
                    <td></td>
                    <td></td>
                `;
                tableFoot.appendChild(totalRow);
            }
            
            // æ·»åŠ ç­›é€‰ç»“æœè¡Œ
            const filterRow = document.createElement('tr');
            filterRow.className = 'table-filter-result';
            filterRow.innerHTML = `<td colspan="8">å…± ${payments.length} æ¡è®°å½•</td>`;
            tableFoot.appendChild(filterRow);
            
            // æ·»åŠ å‹¾é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.payment-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
                    updateCheckAllState('payments');
                });
            });
            
            // æ·»åŠ å…¨é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.getElementById('payments-check-all').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.payment-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
            });
            
            // æ·»åŠ ç»“ç®—çŠ¶æ€é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            document.querySelectorAll('#payment-table .settlement-select').forEach(select => {
                select.addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const value = this.value;
                    
                    const payments = JSON.parse(localStorage.getItem('payments'));
                    payments[index].settlement = value;
                    localStorage.setItem('payments', JSON.stringify(payments));
                });
            });
            
            // æ·»åŠ å¯ç¼–è¾‘å•å…ƒæ ¼äº‹ä»¶ç›‘å¬
            document.querySelectorAll('#payment-table .editable-cell').forEach(cell => {
                cell.addEventListener('blur', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const field = this.getAttribute('data-field');
                    const value = this.textContent;
                    
                    const payments = JSON.parse(localStorage.getItem('payments'));
                    payments[index][field] = value;
                    localStorage.setItem('payments', JSON.stringify(payments));
                });
            });
        }
        
        // è´§æ¬¾æ”¯ä»˜å…¨é€‰/å–æ¶ˆå…¨é€‰
        document.getElementById('select-all-payments').addEventListener('click', function() {
            document.querySelectorAll('.payment-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            document.getElementById('payments-check-all').checked = true;
        });
        
        document.getElementById('deselect-all-payments').addEventListener('click', function() {
            document.querySelectorAll('.payment-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('payments-check-all').checked = false;
        });
        
        // è´§æ¬¾æ”¯ä»˜å–æ¶ˆç­›é€‰
        document.getElementById('clear-filter-payments').addEventListener('click', function() {
            // è¿™é‡Œå¯ä»¥å®ç°ç­›é€‰é€»è¾‘ï¼Œç›®å‰åªæ˜¯é‡æ–°åŠ è½½è¡¨æ ¼
            updatePaymentTable();
            alert('ç­›é€‰å·²å–æ¶ˆï¼');
        });
        
        // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
        function updateCheckAllState(tableType) {
            const checkboxes = document.querySelectorAll(`.${tableType}-checkbox`);
            const checkAll = document.getElementById(`${tableType}-check-all`);
            
            const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            checkAll.checked = allChecked;
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        initData();
    </script>
</body>
</html>