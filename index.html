<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电商合伙账簿系统</title>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.3; /* 减小行高 */
            font-size: 11px; /* 减小基础字体大小 */
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 8px; /* 减小内边距 */
        }
        
        header {
            text-align: center;
            margin-bottom: 12px; /* 减小间距 */
            padding-bottom: 6px; /* 减小内边距 */
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 0;
            background-color: #f5f7fa;
            z-index: 100;
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 2px; /* 减小间距 */
            font-size: 1.1rem; /* 减小字体大小 */
        }
        
        h2 {
            font-size: 0.9rem; /* 减小字体大小 */
            margin-bottom: 6px; /* 减小间距 */
            color: var(--primary);
            padding-bottom: 4px; /* 减小内边距 */
            border-bottom: 1px solid #eee;
        }
        
        h3 {
            font-size: 0.8rem; /* 减小字体大小 */
            margin-bottom: 4px; /* 减小间距 */
        }
        
        .page {
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 12px; /* 减小内边距 */
            margin-bottom: 15px;
            min-height: 400px;
        }
        
        /* 紧凑布局样式 - 进一步减小最小宽度以适应窄屏手机 */
        .compact-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px; /* 减小间隙 */
            margin-bottom: 12px; /* 减小间距 */
        }
        
        .compact-item {
            flex: 1;
            min-width: 110px; /* 进一步减小最小宽度 */
            background: white;
            border-radius: 3px; /* 减小圆角 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* 减小阴影 */
            padding: 8px; /* 减小内边距 */
        }
        
        .compact-item h3 {
            color: var(--dark);
            margin-bottom: 4px; /* 减小间距 */
            font-size: 0.75rem; /* 减小字体大小 */
            letter-spacing: -0.2px; /* 减小字间距 */
        }
        
        .balance {
            font-size: 1rem; /* 减小字体大小 */
            font-weight: bold;
            color: var(--primary);
        }
        
        .currency {
            font-size: 0.65rem; /* 减小字体大小 */
            color: #666;
        }
        
        .total-card {
            background: #e8f4fd;
            border-radius: 3px; /* 减小圆角 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* 减小阴影 */
            padding: 8px; /* 减小内边距 */
            flex: 1;
            min-width: 110px; /* 进一步减小最小宽度 */
        }
        
        .total-card h3 {
            color: var(--dark);
            margin-bottom: 4px; /* 减小间距 */
            font-size: 0.75rem; /* 减小字体大小 */
            letter-spacing: -0.2px; /* 减小字间距 */
        }
        
        /* 表单样式 - 进一步减小最小宽度 */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px; /* 减小间隙 */
            margin-bottom: 6px; /* 减小间距 */
        }
        
        .form-group {
            flex: 1;
            min-width: 90px; /* 进一步减小最小宽度 */
        }
        
        label {
            display: block;
            margin-bottom: 1px; /* 减小间距 */
            font-weight: 500;
            font-size: 0.7rem; /* 减小字体大小 */
            letter-spacing: -0.1px; /* 减小字间距 */
        }
        
        input, select, textarea {
            width: 100%;
            padding: 4px; /* 减小内边距 */
            border: 1px solid #ddd;
            border-radius: 2px; /* 减小圆角 */
            font-size: 0.7rem; /* 减小字体大小 */
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 5px 8px; /* 减小内边距 */
            border-radius: 2px; /* 减小圆角 */
            cursor: pointer;
            font-size: 0.7rem; /* 减小字体大小 */
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--secondary);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem; /* 减小字体大小 */
            margin-top: 8px; /* 减小间距 */
        }
        
        th, td {
            padding: 5px 6px; /* 减小内边距 */
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            font-size: 0.7rem; /* 减小字体大小 */
        }
        
        .income {
            color: var(--secondary);
        }
        
        .expense {
            color: var(--danger);
        }
        
        .advance {
            color: var(--warning);
        }
        
        .settlement {
            color: #9b59b6;
        }
        
        .returnable {
            color: #e67e22;
        }
        
        .exchange-rates {
            background: white;
            border-radius: 3px; /* 减小圆角 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* 减小阴影 */
            padding: 8px; /* 减小内边距 */
            margin-bottom: 12px; /* 减小间距 */
        }
        
        .rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0; /* 减小内边距 */
            border-bottom: 1px solid #eee;
        }
        
        .rate-item:last-child {
            border-bottom: none;
        }
        
        footer {
            text-align: center;
            margin-top: 15px;
            padding-top: 8px; /* 减小内边距 */
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.65rem; /* 减小字体大小 */
        }
        
        .summary {
            background: white;
            border-radius: 3px; /* 减小圆角 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* 减小阴影 */
            padding: 8px; /* 减小内边距 */
            margin-bottom: 12px; /* 减小间距 */
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0; /* 减小内边距 */
            border-bottom: 1px solid #eee;
        }
        
        .summary-row:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            font-weight: 500;
            font-size: 0.7rem; /* 减小字体大小 */
        }
        
        .summary-value {
            font-weight: bold;
            font-size: 0.7rem; /* 减小字体大小 */
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 2px; /* 减小间距 */
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 3px; /* 减小间距 */
        }
        
        .checkbox-group label {
            margin-bottom: 0;
            font-weight: normal;
        }
        
        .nav-menu {
            display: flex;
            justify-content: center;
            margin-bottom: 12px; /* 减小间距 */
            background: white;
            padding: 8px; /* 减小内边距 */
            border-radius: 3px; /* 减小圆角 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* 减小阴影 */
            position: sticky;
            top: 50px; /* 调整粘性位置 */
            z-index: 99;
        }
        
        .nav-item {
            padding: 6px 10px; /* 减小内边距 */
            margin: 0 3px; /* 减小间距 */
            cursor: pointer;
            border-radius: 2px; /* 减小圆角 */
            font-size: 0.7rem; /* 减小字体大小 */
            transition: all 0.3s;
            letter-spacing: -0.1px; /* 减小字间距 */
        }
        
        .nav-item:hover {
            background-color: #e8f4fd;
        }
        
        .nav-item.active {
            background-color: var(--primary);
            color: white;
        }
        
        /* 调整响应式断点，使在窄屏手机上也能保持一行多列 */
        @media (max-width: 600px) {
            .form-row {
                flex-direction: row; /* 保持水平排列 */
            }
            
            .form-group {
                min-width: calc(50% - 3px); /* 两列布局 */
                flex: 0 0 calc(50% - 3px);
            }
            
            .compact-row {
                flex-direction: row; /* 保持水平排列 */
            }
            
            .compact-item, .total-card {
                min-width: calc(50% - 4px); /* 两列布局，每列占50%减去间隙的一半 */
                flex: 0 0 calc(50% - 4px);
            }
            
            .nav-menu {
                flex-wrap: wrap;
            }
            
            .nav-item {
                margin-bottom: 4px; /* 减小间距 */
                flex: 1;
                text-align: center;
                min-width: 70px; /* 减小最小宽度 */
            }
        }
        
        @media (max-width: 350px) {
            .compact-item, .total-card {
                min-width: 100%; /* 在非常小的屏幕上切换到单列 */
                flex: 0 0 100%;
            }
            
            .form-group {
                min-width: 100%; /* 在非常小的屏幕上切换到单列 */
                flex: 0 0 100%;
            }
        }
        
        .goods-table-container, .expenses-table-container, .freight-table-container, .payment-table-container {
            overflow-x: auto;
            margin-top: 8px; /* 减小间距 */
        }
        
        .total-row {
            background-color: #f0f8ff;
            font-weight: bold;
        }
        
        .filter-row {
            background-color: #f8f9fa;
            padding: 6px; /* 减小内边距 */
            margin-bottom: 8px; /* 减小间距 */
            border-radius: 3px; /* 减小圆角 */
            display: flex;
            flex-wrap: wrap;
            gap: 8px; /* 减小间隙 */
        }
        
        .filter-group {
            flex: 1;
            min-width: 100px; /* 进一步减小最小宽度 */
        }
        
        .freight-calculation-table {
            margin-top: 12px; /* 减小间距 */
            width: 100%;
        }
        
        .freight-calculation-table th, .freight-calculation-table td {
            padding: 4px; /* 减小内边距 */
            text-align: center;
        }
        
        .hidden {
            display: none;
        }
        
        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px; /* 减小间隙 */
            margin-bottom: 8px; /* 减小间距 */
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
        }
        
        .checkbox-item input {
            width: auto;
            margin-right: 4px; /* 减小间距 */
        }
        
        .form-actions {
            display: flex;
            gap: 8px; /* 减小间隙 */
            margin-top: 8px; /* 减小间距 */
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>电商合伙账簿系统</h1>
            <p style="font-size: 0.75rem;">基于您的货物清单、收支记录和运费支出表</p>
        </header>
        
        <div class="nav-menu">
            <div class="nav-item active" data-target="page-overview">概览</div>
            <div class="nav-item" data-target="page-accounts">账户余额</div>
            <div class="nav-item" data-target="page-goods">货物清单</div>
            <div class="nav-item" data-target="page-expenses">收支记录</div>
            <div class="nav-item" data-target="page-freight">运费支出</div>
            <div class="nav-item" data-target="page-payment">货款支付记录</div>
            <div class="nav-item" data-target="page-settings">设置</div>
        </div>
        
        <!-- 概览页面 -->
        <div class="page" id="page-overview">
            <h2>概览</h2>
            
            <div class="compact-row">
                <div class="compact-item">
                    <h3>OZON账户余额 (₽)</h3>
                    <div class="balance" id="ozon-balance-display">0.00</div>
                </div>
                <div class="compact-item">
                    <h3>WB账户余额 (₽)</h3>
                    <div class="balance" id="wb-balance-display">0.00</div>
                </div>
            </div>
            
            <div class="compact-row">
                <div class="compact-item">
                    <h3>个体账户余额 (₽)</h3>
                    <div class="balance" id="business-balance-display">0.00</div>
                </div>
                <div class="compact-item">
                    <h3>现金余额 (₽)</h3>
                    <div class="balance" id="cash-balance-display">0.00</div>
                </div>
            </div>
            
            <div class="compact-row">
                <div class="total-card">
                    <h3>总金额 (₽)</h3>
                    <div class="balance" id="total-balance">0.00</div>
                </div>
            </div>
        </div>
        
        <!-- 账户余额页面 -->
        <div class="page" id="page-accounts" style="display: none;">
            <h2>账户余额管理</h2>
            
            <div class="compact-row">
                <div class="compact-item">
                    <h3>OZON账户余额 (₽)</h3>
                    <input type="number" id="ozon-balance" step="0.01" placeholder="0.00" value="0">
                </div>
                <div class="compact-item">
                    <h3>WB账户余额 (₽)</h3>
                    <input type="number" id="wb-balance" step="0.01" placeholder="0.00" value="0">
                </div>
            </div>
            
            <div class="compact-row">
                <div class="compact-item">
                    <h3>个体账户余额 (₽)</h3>
                    <input type="number" id="business-balance" step="0.01" placeholder="0.00" value="0">
                </div>
                <div class="compact-item">
                    <h3>现金余额 (₽)</h3>
                    <input type="number" id="cash-balance" step="0.01" placeholder="0.00" value="0">
                </div>
            </div>
            
            <div class="compact-row">
                <button id="save-balances" class="btn-success">保存余额</button>
            </div>
            
            <div class="compact-row">
                <div class="total-card">
                    <h3>总金额 (₽)</h3>
                    <div class="balance" id="total-balance-accounts">0.00</div>
                </div>
            </div>
        </div>
        
        <!-- 其他页面保持不变，但会继承新的紧凑样式 -->
        <!-- 货物清单页面 -->
        <div class="page" id="page-goods" style="display: none;">
            <h2>货物清单</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="goods-date">到货日期</label>
                    <input type="text" id="goods-date" placeholder="20251122" maxlength="8">
                </div>
                <div class="form-group" style="flex: 2;">
                    <label for="goods-name">产品名称</label>
                    <input type="text" id="goods-name" placeholder="例如：电镀盒子Android99TV" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="goods-color">颜色</label>
                    <input type="text" id="goods-color" placeholder="例如：黑">
                </div>
                <div class="form-group">
                    <label for="goods-unit">单位</label>
                    <input type="text" id="goods-unit" placeholder="例如：PCS">
                </div>
                <div class="form-group">
                    <label for="goods-quantity">数量</label>
                    <input type="number" id="goods-quantity" placeholder="0" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="goods-price">单价 (¥)</label>
                    <input type="number" id="goods-price" step="0.01" placeholder="0.00" required>
                </div>
                <div class="form-group">
                    <label for="goods-amount">金额 (¥)</label>
                    <input type="number" id="goods-amount" step="0.01" placeholder="0.00" readonly>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label for="goods-notes">备注</label>
                    <input type="text" id="goods-notes" placeholder="例如：给小米代理拉走">
                </div>
                <button type="button" id="add-goods" style="margin-top: 15px;">添加货物</button>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="goods-rub-rate">折成卢布 (₽)</label>
                    <input type="number" id="goods-rub-rate" step="0.0001" value="12.50">
                </div>
                <div class="form-group">
                    <label for="goods-freight-ratio">运费平摊</label>
                    <input type="number" id="goods-freight-ratio" step="0.0001" value="1.00">
                </div>
                <div class="form-group">
                    <label for="goods-rub-price">卢布单价 (₽)</label>
                    <input type="number" id="goods-rub-price" step="0.01" readonly>
                </div>
            </div>
            
            <div class="filter-row">
                <div class="filter-group">
                    <label for="filter-date">日期筛选:</label>
                    <input type="text" id="filter-date" placeholder="20251122">
                </div>
                <div class="filter-group">
                    <label for="filter-name">名称筛选:</label>
                    <input type="text" id="filter-name">
                </div>
                <div class="filter-group">
                    <label for="filter-color">颜色筛选:</label>
                    <input type="text" id="filter-color">
                </div>
                <div class="filter-group">
                    <label for="filter-notes">备注筛选:</label>
                    <input type="text" id="filter-notes">
                </div>
                <button id="apply-filter">应用筛选</button>
                <button id="clear-filter" class="btn-warning">清除筛选</button>
            </div>
            
            <h3>货物记录</h3>
            <div class="goods-table-container">
                <table id="goods-table">
                    <thead>
                        <tr>
                            <th>到货日期</th>
                            <th>产品名称</th>
                            <th>颜色</th>
                            <th>单位</th>
                            <th>数量</th>
                            <th>单价(¥)</th>
                            <th>金额(¥)</th>
                            <th style="min-width: 150px;">备注</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="goods-body">
                        <!-- 货物记录将在这里动态生成 -->
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="4">总计</td>
                            <td id="total-quantity">0</td>
                            <td></td>
                            <td id="total-amount">0.00</td>
                            <td colspan="2"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        
        <!-- 其他页面保持不变 -->
        <!-- 收支记录页面 -->
        <div class="page" id="page-expenses" style="display: none;">
            <h2>收支记录</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="expense-date">日期</label>
                    <input type="text" id="expense-date" placeholder="20251122" maxlength="8">
                </div>
                <div class="form-group">
                    <label>收支类型</label>
                    <div class="checkbox-container">
                        <div class="checkbox-item">
                            <input type="checkbox" id="expense-type-sales" name="expense-type" value="sales">
                            <label for="expense-type-sales">销售货款</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="expense-type-expense" name="expense-type" value="expense">
                            <label for="expense-type-expense">费用支出</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>支付及存储</label>
                    <div class="checkbox-container">
                        <div class="checkbox-item">
                            <input type="checkbox" id="expense-payment-public-income" name="expense-payment" value="public-income">
                            <label for="expense-payment-public-income">公账收入</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="expense-payment-cash-income" name="expense-payment" value="cash-income">
                            <label for="expense-payment-cash-income">现金收入</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="expense-payment-public-expense" name="expense-payment" value="public-expense">
                            <label for="expense-payment-public-expense">公账支付</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="expense-payment-cash-expense" name="expense-payment" value="cash-expense">
                            <label for="expense-payment-cash-expense">现金支付</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label for="expense-description">描述</label>
                    <input type="text" id="expense-description" placeholder="例如：5-6月2个月租金+1个月押金每月16800卢布" required>
                </div>
                <div class="form-group">
                    <label for="expense-amount">金额 (₽)</label>
                    <input type="number" id="expense-amount" step="0.01" placeholder="0.00" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label for="expense-notes">注释</label>
                    <input type="text" id="expense-notes" placeholder="例如：打到账号里垫付">
                </div>
                <button type="button" id="add-expense" style="margin-top: 15px;">添加记录</button>
            </div>
            
            <h3>收支记录列表</h3>
            <div class="expenses-table-container">
                <table id="expenses-table">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>收支类型</th>
                            <th>支付及存储</th>
                            <th>描述</th>
                            <th>金额(₽)</th>
                            <th>注释</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="expenses-body">
                        <!-- 收支记录将在这里动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 运费支出页面 -->
        <div class="page" id="page-freight" style="display: none;">
            <h2>运费支出</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="freight-date">日期</label>
                    <input type="text" id="freight-date" placeholder="20251122" maxlength="8">
                </div>
                <div class="form-group" style="flex: 2;">
                    <label for="freight-product">产品名称</label>
                    <input type="text" id="freight-product" placeholder="例如：电镀盒子Android99TV" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="freight-weight">重量 (公斤)</label>
                    <input type="number" id="freight-weight" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="freight-volume">体积 (立方米)</label>
                    <input type="number" id="freight-volume" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="freight-amount">运费</label>
                    <input type="number" id="freight-amount" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="freight-currency">币种</label>
                    <select id="freight-currency">
                        <option value="RUB">卢布</option>
                        <option value="CNY">人民币</option>
                        <option value="USD">美金</option>
                    </select>
                </div>
                <div class="form-group" id="exchange-rate-group" style="display: none;">
                    <label for="freight-exchange-rate">汇率</label>
                    <input type="number" id="freight-exchange-rate" step="0.0001" placeholder="0.0000">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="freight-pallet">托盘费 (₽)</label>
                    <input type="number" id="freight-pallet" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="freight-cubic">立方费 (₽)</label>
                    <input type="number" id="freight-cubic" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="freight-delivery">运输车费 (₽)</label>
                    <input type="number" id="freight-delivery" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="freight-total">费用总计 (₽)</label>
                    <input type="number" id="freight-total" step="0.01" placeholder="0.00" readonly>
                </div>
                <div class="form-group" style="flex: 2;">
                    <label for="freight-notes">备注</label>
                    <input type="text" id="freight-notes" placeholder="例如：总已付人民币5285元">
                </div>
                <button type="button" id="add-freight" style="margin-top: 15px;">添加运费</button>
            </div>
            
            <h3>运费均摊计算</h3>
            <div class="freight-table-container">
                <table class="freight-calculation-table">
                    <thead>
                        <tr>
                            <th>产品名称</th>
                            <th>单价 (¥)</th>
                            <th>数量</th>
                            <th>重量 (克)</th>
                            <th>折成卢布单价 (₽)</th>
                            <th>含运费价格 (₽)</th>
                            <th>
                                <button type="button" id="add-freight-row" class="btn-success">添加行</button>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="freight-calculation-body">
                        <tr>
                            <td><input type="text" class="calc-product" placeholder="产品名称"></td>
                            <td><input type="number" class="calc-price" step="0.01" placeholder="0.00"></td>
                            <td><input type="number" class="calc-quantity" placeholder="0"></td>
                            <td><input type="number" class="calc-weight" step="0.01" placeholder="0.00"></td>
                            <td><input type="number" class="calc-rub-price" step="0.01" placeholder="0.00" readonly></td>
                            <td><input type="number" class="calc-total-price" step="0.01" placeholder="0.00" readonly></td>
                            <td><button type="button" class="btn-danger remove-freight-row">删除</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h3>运费记录列表</h3>
            <div class="freight-table-container">
                <table id="freight-table">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>产品名称</th>
                            <th>重量(公斤)</th>
                            <th>体积(立方米)</th>
                            <th>运费</th>
                            <th>币种</th>
                            <th>汇率</th>
                            <th>托盘费(₽)</th>
                            <th>立方费(₽)</th>
                            <th>运输车费(₽)</th>
                            <th>费用总计(₽)</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="freight-body">
                        <!-- 运费记录将在这里动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 货款支付记录页面 -->
        <div class="page" id="page-payment" style="display: none;">
            <h2>货款支付记录</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="payment-date">日期</label>
                    <input type="text" id="payment-date" placeholder="20251122" maxlength="8">
                </div>
                <div class="form-group">
                    <label for="payment-amount">打款数额 (¥)</label>
                    <input type="number" id="payment-amount" step="0.01" placeholder="0.00" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="payment-recipient">收款人</label>
                    <input type="text" id="payment-recipient" placeholder="收款人姓名" required>
                </div>
                <div class="form-group">
                    <label for="payment-account">账户</label>
                    <input type="text" id="payment-account" placeholder="收款账户" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label for="payment-description">打款款项说明</label>
                    <input type="text" id="payment-description" placeholder="例如：移动硬盘货款" required>
                </div>
                <div class="form-group">
                    <label for="payment-arrived">是否到货</label>
                    <select id="payment-arrived">
                        <option value="no">未到货</option>
                        <option value="yes">已到货</option>
                        <option value="partial">部分到货</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label for="payment-notes">备注</label>
                    <input type="text" id="payment-notes" placeholder="可选的备注信息">
                </div>
                <button type="button" id="add-payment" style="margin-top: 15px;">添加记录</button>
            </div>
            
            <h3>货款支付记录列表</h3>
            <div class="payment-table-container">
                <table id="payment-table">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>打款数额(¥)</th>
                            <th>收款人</th>
                            <th>账户</th>
                            <th>打款款项说明</th>
                            <th>是否到货</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="payment-body">
                        <!-- 货款支付记录将在这里动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 设置页面 -->
        <div class="page" id="page-settings" style="display: none;">
            <h2>设置</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="setting-default-currency">默认币种</label>
                    <select id="setting-default-currency">
                        <option value="RUB">卢布 (₽)</option>
                        <option value="CNY">人民币 (¥)</option>
                        <option value="USD">美金 ($)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="setting-default-exchange-rate">默认汇率 (1CNY=₽)</label>
                    <input type="number" id="setting-default-exchange-rate" step="0.0001" value="12.50">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="setting-freight-ratio">默认运费平摊比率</label>
                    <input type="number" id="setting-freight-ratio" step="0.0001" value="1.00">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <button id="save-settings" class="btn-success">保存设置</button>
                </div>
                <div class="form-group">
                    <button id="reset-data" class="btn-danger">重置所有数据</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>电商合伙账簿系统 &copy; 2023 - 基于您的货物清单、收支记录和运费支出表</p>
        </footer>
    </div>

    <!-- JavaScript部分保持不变 -->
    <script>
        // 初始化数据
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let goods = JSON.parse(localStorage.getItem('goods')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let freight = JSON.parse(localStorage.getItem('freight')) || [];
        let payments = JSON.parse(localStorage.getItem('payments')) || [];
        let accountBalances = JSON.parse(localStorage.getItem('accountBalances')) || {
            ozon: 0,
            wb: 0,
            business: 0,
            cash: 0
        };
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            defaultCurrency: 'RUB',
            defaultExchangeRate: 12.50,
            freightRatio: 1.00
        };

        // 确保所有值都是数字
        accountBalances.ozon = parseFloat(accountBalances.ozon) || 0;
        accountBalances.wb = parseFloat(accountBalances.wb) || 0;
        accountBalances.business = parseFloat(accountBalances.business) || 0;
        accountBalances.cash = parseFloat(accountBalances.cash) || 0;

        // DOM元素
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        
        // 账户余额输入框
        const ozonBalanceInput = document.getElementById('ozon-balance');
        const wbBalanceInput = document.getElementById('wb-balance');
        const businessBalanceInput = document.getElementById('business-balance');
        const cashBalanceInput = document.getElementById('cash-balance');
        
        // 余额显示
        const ozonBalanceDisplay = document.getElementById('ozon-balance-display');
        const wbBalanceDisplay = document.getElementById('wb-balance-display');
        const businessBalanceDisplay = document.getElementById('business-balance-display');
        const cashBalanceDisplay = document.getElementById('cash-balance-display');
        const totalBalanceEl = document.getElementById('total-balance');
        const totalBalanceAccountsEl = document.getElementById('total-balance-accounts');
        
        // 货物表单
        const addGoodsBtn = document.getElementById('add-goods');
        const goodsBody = document.getElementById('goods-body');
        const goodsPriceInput = document.getElementById('goods-price');
        const goodsQuantityInput = document.getElementById('goods-quantity');
        const goodsAmountInput = document.getElementById('goods-amount');
        const goodsRubRateInput = document.getElementById('goods-rub-rate');
        const goodsFreightRatioInput = document.getElementById('goods-freight-ratio');
        const goodsRubPriceInput = document.getElementById('goods-rub-price');
        
        // 货物筛选
        const filterDateInput = document.getElementById('filter-date');
        const filterNameInput = document.getElementById('filter-name');
        const filterColorInput = document.getElementById('filter-color');
        const filterNotesInput = document.getElementById('filter-notes');
        const applyFilterBtn = document.getElementById('apply-filter');
        const clearFilterBtn = document.getElementById('clear-filter');
        
        // 支出表单
        const addExpenseBtn = document.getElementById('add-expense');
        const expensesBody = document.getElementById('expenses-body');
        
        // 运费表单
        const addFreightBtn = document.getElementById('add-freight');
        const freightBody = document.getElementById('freight-body');
        const freightCurrencySelect = document.getElementById('freight-currency');
        const exchangeRateGroup = document.getElementById('exchange-rate-group');
        const freightAmountInput = document.getElementById('freight-amount');
        const freightExchangeRateInput = document.getElementById('freight-exchange-rate');
        const freightPalletInput = document.getElementById('freight-pallet');
        const freightCubicInput = document.getElementById('freight-cubic');
        const freightDeliveryInput = document.getElementById('freight-delivery');
        const freightTotalInput = document.getElementById('freight-total');
        
        // 运费计算表格
        const addFreightRowBtn = document.getElementById('add-freight-row');
        const freightCalculationBody = document.getElementById('freight-calculation-body');
        
        // 货款支付表单
        const addPaymentBtn = document.getElementById('add-payment');
        const paymentBody = document.getElementById('payment-body');
        
        // 设置表单
        const saveSettingsBtn = document.getElementById('save-settings');
        const resetDataBtn = document.getElementById('reset-data');
        const settingDefaultCurrencySelect = document.getElementById('setting-default-currency');
        const settingDefaultExchangeRateInput = document.getElementById('setting-default-exchange-rate');
        const settingFreightRatioInput = document.getElementById('setting-freight-ratio');
        
        // 保存余额按钮
        const saveBalancesBtn = document.getElementById('save-balances');

        // 初始化数据
        ozonBalanceInput.value = accountBalances.ozon;
        wbBalanceInput.value = accountBalances.wb;
        businessBalanceInput.value = accountBalances.business;
        cashBalanceInput.value = accountBalances.cash;
        
        settingDefaultCurrencySelect.value = settings.defaultCurrency;
        settingDefaultExchangeRateInput.value = settings.defaultExchangeRate;
        settingFreightRatioInput.value = settings.freightRatio;
        
        goodsRubRateInput.value = settings.defaultExchangeRate;
        goodsFreightRatioInput.value = settings.freightRatio;

        // 初始化显示
        updateTotalBalance();
        renderGoods();
        renderExpenses();
        renderFreight();
        renderPayments();

        // 导航菜单事件
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const target = item.getAttribute('data-target');
                
                navItems.forEach(nav => nav.classList.remove('active'));
                pages.forEach(page => page.style.display = 'none');
                
                item.classList.add('active');
                document.getElementById(target).style.display = 'block';
            });
        });

        // 保存账户余额
        saveBalancesBtn.addEventListener('click', updateAccountBalances);
        
        // 账户余额变化时更新
        ozonBalanceInput.addEventListener('change', updateAccountBalances);
        wbBalanceInput.addEventListener('change', updateAccountBalances);
        businessBalanceInput.addEventListener('change', updateAccountBalances);
        cashBalanceInput.addEventListener('change', updateAccountBalances);

        // 更新账户余额
        function updateAccountBalances() {
            accountBalances.ozon = parseFloat(ozonBalanceInput.value) || 0;
            accountBalances.wb = parseFloat(wbBalanceInput.value) || 0;
            accountBalances.business = parseFloat(businessBalanceInput.value) || 0;
            accountBalances.cash = parseFloat(cashBalanceInput.value) || 0;
            
            localStorage.setItem('accountBalances', JSON.stringify(accountBalances));
            updateTotalBalance();
        }
        
        // 更新总余额
        function updateTotalBalance() {
            const totalBalance = accountBalances.ozon + accountBalances.wb + accountBalances.business + accountBalances.cash;
            totalBalanceEl.textContent = totalBalance.toFixed(2);
            totalBalanceAccountsEl.textContent = totalBalance.toFixed(2);
            
            // 更新余额显示
            ozonBalanceDisplay.textContent = accountBalances.ozon.toFixed(2);
            wbBalanceDisplay.textContent = accountBalances.wb.toFixed(2);
            businessBalanceDisplay.textContent = accountBalances.business.toFixed(2);
            cashBalanceDisplay.textContent = accountBalances.cash.toFixed(2);
        }

        // 日期格式化函数
        function formatDate(dateStr) {
            if (dateStr.length === 8) {
                return dateStr.substring(0, 4) + '/' + dateStr.substring(4, 6) + '/' + dateStr.substring(6, 8);
            }
            return dateStr;
        }

        // 货物金额自动计算
        goodsPriceInput.addEventListener('input', calculateGoodsAmount);
        goodsQuantityInput.addEventListener('input', calculateGoodsAmount);
        
        function calculateGoodsAmount() {
            const price = parseFloat(goodsPriceInput.value) || 0;
            const quantity = parseInt(goodsQuantityInput.value) || 0;
            const amount = price * quantity;
            goodsAmountInput.value = amount.toFixed(2);
            
            // 计算卢布单价
            const rubRate = parseFloat(goodsRubRateInput.value) || 0;
            const freightRatio = parseFloat(goodsFreightRatioInput.value) || 0;
            const rubPrice = price * rubRate * freightRatio;
            goodsRubPriceInput.value = rubPrice.toFixed(2);
        }
        
        // 卢布汇率和运费平摊变化时更新卢布单价
        goodsRubRateInput.addEventListener('input', calculateGoodsAmount);
        goodsFreightRatioInput.addEventListener('input', calculateGoodsAmount);

        // 添加货物记录
        addGoodsBtn.addEventListener('click', function() {
            const date = formatDate(document.getElementById('goods-date').value);
            const name = document.getElementById('goods-name').value;
            const color = document.getElementById('goods-color').value;
            const unit = document.getElementById('goods-unit').value;
            const quantity = parseInt(document.getElementById('goods-quantity').value) || 0;
            const price = parseFloat(document.getElementById('goods-price').value) || 0;
            const amount = parseFloat(document.getElementById('goods-amount').value) || 0;
            const notes = document.getElementById('goods-notes').value;
            
            const goodsItem = {
                id: Date.now(),
                date,
                name,
                color,
                unit,
                quantity,
                price,
                amount,
                notes
            };
            
            goods.push(goodsItem);
            saveGoods();
            renderGoods();
            
            // 重置表单
            document.getElementById('goods-date').value = '';
            document.getElementById('goods-name').value = '';
            document.getElementById('goods-color').value = '';
            document.getElementById('goods-unit').value = '';
            document.getElementById('goods-quantity').value = '';
            document.getElementById('goods-price').value = '';
            document.getElementById('goods-amount').value = '';
            document.getElementById('goods-notes').value = '';
        });

        // 删除货物记录
        function deleteGoods(id) {
            goods = goods.filter(g => g.id !== id);
            saveGoods();
            renderGoods();
        }

        // 渲染货物记录
        function renderGoods() {
            goodsBody.innerHTML = '';
            
            if (goods.length === 0) {
                goodsBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">暂无货物记录</td></tr>';
                updateGoodsTotal();
                return;
            }
            
            // 应用筛选
            let filteredGoods = [...goods];
            const filterDate = filterDateInput.value;
            const filterName = filterNameInput.value.toLowerCase();
            const filterColor = filterColorInput.value.toLowerCase();
            const filterNotes = filterNotesInput.value.toLowerCase();
            
            if (filterDate) {
                const formattedFilterDate = formatDate(filterDate);
                filteredGoods = filteredGoods.filter(item => item.date.includes(formattedFilterDate));
            }
            
            if (filterName) {
                filteredGoods = filteredGoods.filter(item => item.name.toLowerCase().includes(filterName));
            }
            
            if (filterColor) {
                filteredGoods = filteredGoods.filter(item => item.color.toLowerCase().includes(filterColor));
            }
            
            if (filterNotes) {
                filteredGoods = filteredGoods.filter(item => item.notes.toLowerCase().includes(filterNotes));
            }
            
            // 按日期排序，最新的在前面
            const sortedGoods = filteredGoods.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedGoods.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.name}</td>
                    <td>${item.color}</td>
                    <td>${item.unit}</td>
                    <td>${item.quantity}</td>
                    <td>${item.price.toFixed(2)}</td>
                    <td>${item.amount.toFixed(2)}</td>
                    <td style="min-width: 150px;">${item.notes}</td>
                    <td><button class="btn-danger" onclick="deleteGoods(${item.id})">删除</button></td>
                `;
                
                goodsBody.appendChild(row);
            });
            
            updateGoodsTotal();
        }

        // 更新货物总计
        function updateGoodsTotal() {
            const totalQuantity = goods.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
            const totalAmount = goods.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0);
            
            document.getElementById('total-quantity').textContent = totalQuantity;
            document.getElementById('total-amount').textContent = totalAmount.toFixed(2);
        }

        // 应用筛选
        applyFilterBtn.addEventListener('click', renderGoods);
        
        // 清除筛选
        clearFilterBtn.addEventListener('click', function() {
            filterDateInput.value = '';
            filterNameInput.value = '';
            filterColorInput.value = '';
            filterNotesInput.value = '';
            renderGoods();
        });

        // 添加收支记录
        addExpenseBtn.addEventListener('click', function() {
            const date = formatDate(document.getElementById('expense-date').value);
            
            // 获取收支类型
            const expenseTypeElements = document.querySelectorAll('input[name="expense-type"]:checked');
            if (expenseTypeElements.length === 0) {
                alert('请选择收支类型');
                return;
            }
            const expenseType = Array.from(expenseTypeElements).map(el => el.value).join(',');
            
            // 获取支付及存储
            const expensePaymentElements = document.querySelectorAll('input[name="expense-payment"]:checked');
            if (expensePaymentElements.length === 0) {
                alert('请选择支付及存储方式');
                return;
            }
            const expensePayment = Array.from(expensePaymentElements).map(el => el.value).join(',');
            
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value) || 0;
            const notes = document.getElementById('expense-notes').value;
            
            const expenseItem = {
                id: Date.now(),
                date,
                expenseType,
                expensePayment,
                description,
                amount,
                notes
            };
            
            expenses.push(expenseItem);
            saveExpenses();
            renderExpenses();
            
            // 重置表单
            document.getElementById('expense-date').value = '';
            document.querySelectorAll('input[name="expense-type"]').forEach(el => el.checked = false);
            document.querySelectorAll('input[name="expense-payment"]').forEach(el => el.checked = false);
            document.getElementById('expense-description').value = '';
            document.getElementById('expense-amount').value = '';
            document.getElementById('expense-notes').value = '';
        });

        // 删除收支记录
        function deleteExpense(id) {
            expenses = expenses.filter(e => e.id !== id);
            saveExpenses();
            renderExpenses();
        }

        // 渲染收支记录
        function renderExpenses() {
            expensesBody.innerHTML = '';
            
            if (expenses.length === 0) {
                expensesBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">暂无收支记录</td></tr>';
                return;
            }
            
            // 按日期排序，最新的在前面
            const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedExpenses.forEach(expense => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${expense.date}</td>
                    <td>${expense.expenseType === 'sales' ? '销售货款' : '费用支出'}</td>
                    <td>${getPaymentDisplayText(expense.expensePayment)}</td>
                    <td>${expense.description}</td>
                    <td>${expense.amount.toFixed(2)}</td>
                    <td>${expense.notes}</td>
                    <td><button class="btn-danger" onclick="deleteExpense(${expense.id})">删除</button></td>
                `;
                
                expensesBody.appendChild(row);
            });
        }

        // 获取支付方式显示文本
        function getPaymentDisplayText(payment) {
            const paymentMap = {
                'public-income': '公账收入',
                'cash-income': '现金收入',
                'public-expense': '公账支付',
                'cash-expense': '现金支付'
            };
            
            return payment.split(',').map(p => paymentMap[p]).join(', ');
        }

        // 运费币种变化事件
        freightCurrencySelect.addEventListener('change', function() {
            if (this.value === 'RUB') {
                exchangeRateGroup.style.display = 'none';
            } else {
                exchangeRateGroup.style.display = 'block';
            }
            calculateFreightTotal();
        });

        // 运费计算
        freightAmountInput.addEventListener('input', calculateFreightTotal);
        freightExchangeRateInput.addEventListener('input', calculateFreightTotal);
        freightPalletInput.addEventListener('input', calculateFreightTotal);
        freightCubicInput.addEventListener('input', calculateFreightTotal);
        freightDeliveryInput.addEventListener('input', calculateFreightTotal);

        function calculateFreightTotal() {
            const amount = parseFloat(freightAmountInput.value) || 0;
            const currency = freightCurrencySelect.value;
            const exchangeRate = parseFloat(freightExchangeRateInput.value) || 0;
            const pallet = parseFloat(freightPalletInput.value) || 0;
            const cubic = parseFloat(freightCubicInput.value) || 0;
            const delivery = parseFloat(freightDeliveryInput.value) || 0;
            
            let amountInRub = amount;
            
            if (currency === 'CNY' || currency === 'USD') {
                if (exchangeRate < 1) {
                    amountInRub = amount / exchangeRate;
                } else {
                    amountInRub = amount * exchangeRate;
                }
            }
            
            const total = amountInRub + pallet + cubic + delivery;
            freightTotalInput.value = total.toFixed(2);
        }

        // 添加运费记录
        addFreightBtn.addEventListener('click', function() {
            const date = formatDate(document.getElementById('freight-date').value);
            const product = document.getElementById('freight-product').value;
            const weight = parseFloat(document.getElementById('freight-weight').value) || 0;
            const volume = parseFloat(document.getElementById('freight-volume').value) || 0;
            const amount = parseFloat(document.getElementById('freight-amount').value) || 0;
            const currency = freightCurrencySelect.value;
            const exchangeRate = parseFloat(freightExchangeRateInput.value) || 0;
            const pallet = parseFloat(freightPalletInput.value) || 0;
            const cubic = parseFloat(freightCubicInput.value) || 0;
            const delivery = parseFloat(freightDeliveryInput.value) || 0;
            const total = parseFloat(freightTotalInput.value) || 0;
            const notes = document.getElementById('freight-notes').value;
            
            const freightItem = {
                id: Date.now(),
                date,
                product,
                weight,
                volume,
                amount,
                currency,
                exchangeRate,
                pallet,
                cubic,
                delivery,
                total,
                notes
            };
            
            freight.push(freightItem);
            saveFreight();
            renderFreight();
            
            // 重置表单
            document.getElementById('freight-date').value = '';
            document.getElementById('freight-product').value = '';
            document.getElementById('freight-weight').value = '';
            document.getElementById('freight-volume').value = '';
            document.getElementById('freight-amount').value = '';
            freightCurrencySelect.value = 'RUB';
            exchangeRateGroup.style.display = 'none';
            freightExchangeRateInput.value = '';
            freightPalletInput.value = '';
            freightCubicInput.value = '';
            freightDeliveryInput.value = '';
            freightTotalInput.value = '';
            document.getElementById('freight-notes').value = '';
        });

        // 删除运费记录
        function deleteFreight(id) {
            freight = freight.filter(f => f.id !== id);
            saveFreight();
            renderFreight();
        }

        // 渲染运费记录
        function renderFreight() {
            freightBody.innerHTML = '';
            
            if (freight.length === 0) {
                freightBody.innerHTML = '<tr><td colspan="13" style="text-align: center;">暂无运费记录</td></tr>';
                return;
            }
            
            // 按日期排序，最新的在前面
            const sortedFreight = [...freight].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedFreight.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.product}</td>
                    <td>${item.weight.toFixed(2)}</td>
                    <td>${item.volume.toFixed(2)}</td>
                    <td>${item.amount.toFixed(2)}</td>
                    <td>${item.currency}</td>
                    <td>${item.exchangeRate.toFixed(4)}</td>
                    <td>${item.pallet.toFixed(2)}</td>
                    <td>${item.cubic.toFixed(2)}</td>
                    <td>${item.delivery.toFixed(2)}</td>
                    <td>${item.total.toFixed(2)}</td>
                    <td>${item.notes}</td>
                    <td><button class="btn-danger" onclick="deleteFreight(${item.id})">删除</button></td>
                `;
                
                freightBody.appendChild(row);
            });
        }

        // 添加运费计算行
        addFreightRowBtn.addEventListener('click', function() {
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" class="calc-product" placeholder="产品名称"></td>
                <td><input type="number" class="calc-price" step="0.01" placeholder="0.00"></td>
                <td><input type="number" class="calc-quantity" placeholder="0"></td>
                <td><input type="number" class="calc-weight" step="0.01" placeholder="0.00"></td>
                <td><input type="number" class="calc-rub-price" step="0.01" placeholder="0.00" readonly></td>
                <td><input type="number" class="calc-total-price" step="0.01" placeholder="0.00" readonly></td>
                <td><button type="button" class="btn-danger remove-freight-row">删除</button></td>
            `;
            freightCalculationBody.appendChild(newRow);
            
            // 添加删除行事件
            newRow.querySelector('.remove-freight-row').addEventListener('click', function() {
                newRow.remove();
            });
        });

        // 添加货款支付记录
        addPaymentBtn.addEventListener('click', function() {
            const date = formatDate(document.getElementById('payment-date').value);
            const amount = parseFloat(document.getElementById('payment-amount').value) || 0;
            const recipient = document.getElementById('payment-recipient').value;
            const account = document.getElementById('payment-account').value;
            const description = document.getElementById('payment-description').value;
            const arrived = document.getElementById('payment-arrived').value;
            const notes = document.getElementById('payment-notes').value;
            
            const paymentItem = {
                id: Date.now(),
                date,
                amount,
                recipient,
                account,
                description,
                arrived,
                notes
            };
            
            payments.push(paymentItem);
            savePayments();
            renderPayments();
            
            // 重置表单
            document.getElementById('payment-date').value = '';
            document.getElementById('payment-amount').value = '';
            document.getElementById('payment-recipient').value = '';
            document.getElementById('payment-account').value = '';
            document.getElementById('payment-description').value = '';
            document.getElementById('payment-arrived').value = 'no';
            document.getElementById('payment-notes').value = '';
        });

        // 删除货款支付记录
        function deletePayment(id) {
            payments = payments.filter(p => p.id !== id);
            savePayments();
            renderPayments();
        }

        // 渲染货款支付记录
        function renderPayments() {
            paymentBody.innerHTML = '';
            
            if (payments.length === 0) {
                paymentBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">暂无货款支付记录</td></tr>';
                return;
            }
            
            // 按日期排序，最新的在前面
            const sortedPayments = [...payments].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedPayments.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.amount.toFixed(2)}</td>
                    <td>${item.recipient}</td>
                    <td>${item.account}</td>
                    <td>${item.description}</td>
                    <td>${item.arrived === 'yes' ? '已到货' : item.arrived === 'partial' ? '部分到货' : '未到货'}</td>
                    <td>${item.notes}</td>
                    <td><button class="btn-danger" onclick="deletePayment(${item.id})">删除</button></td>
                `;
                
                paymentBody.appendChild(row);
            });
        }

        // 保存设置
        saveSettingsBtn.addEventListener('click', function() {
            settings.defaultCurrency = settingDefaultCurrencySelect.value;
            settings.defaultExchangeRate = parseFloat(settingDefaultExchangeRateInput.value) || 12.50;
            settings.freightRatio = parseFloat(settingFreightRatioInput.value) || 1.00;
            
            localStorage.setItem('settings', JSON.stringify(settings));
            
            // 更新货物页面的默认值
            goodsRubRateInput.value = settings.defaultExchangeRate;
            goodsFreightRatioInput.value = settings.freightRatio;
            
            alert('设置已保存！');
        });

        // 重置所有数据
        resetDataBtn.addEventListener('click', function() {
            if (confirm('确定要重置所有数据吗？此操作不可恢复！')) {
                localStorage.clear();
                location.reload();
            }
        });

        // 保存货物记录到本地存储
        function saveGoods() {
            localStorage.setItem('goods', JSON.stringify(goods));
        }

        // 保存支出记录到本地存储
        function saveExpenses() {
            localStorage.setItem('expenses', JSON.stringify(expenses));
        }

        // 保存运费记录到本地存储
        function saveFreight() {
            localStorage.setItem('freight', JSON.stringify(freight));
        }

        // 保存货款支付记录到本地存储
        function savePayments() {
            localStorage.setItem('payments', JSON.stringify(payments));
        }

        // 初始化日期为今天
        const today = new Date();
        const todayStr = today.getFullYear() + 
                        String(today.getMonth() + 1).padStart(2, '0') + 
                        String(today.getDate()).padStart(2, '0');
        
        document.getElementById('goods-date').value = todayStr;
        document.getElementById('expense-date').value = todayStr;
        document.getElementById('freight-date').value = todayStr;
        document.getElementById('payment-date').value = todayStr;
    </script>
</body>
</html>